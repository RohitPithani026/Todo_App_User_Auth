#!/usr/bin/env node
var vo=Object.create;var Zs=Object.defineProperty;var To=Object.getOwnPropertyDescriptor;var Co=Object.getOwnPropertyNames;var Ao=Object.getPrototypeOf,Ro=Object.prototype.hasOwnProperty;var Oo=(i,t,e)=>t in i?Zs(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var Zi=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var No=(i,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Co(t))!Ro.call(i,r)&&r!==e&&Zs(i,r,{get:()=>t[r],enumerable:!(s=To(t,r))||s.enumerable});return i};var ko=(i,t,e)=>(e=i!=null?vo(Ao(i)):{},No(t||!i||!i.__esModule?Zs(e,"default",{value:i,enumerable:!0}):e,i));var Qi=(i,t,e)=>(Oo(i,typeof t!="symbol"?t+"":t,e),e),Qs=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var y=(i,t,e)=>(Qs(i,t,"read from private field"),e?e.call(i):t.get(i)),z=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},R=(i,t,e,s)=>(Qs(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);var Ht=(i,t,e)=>(Qs(i,t,"access private method"),e);var Br=Zi((xu,Wr)=>{"use strict";Wr.exports=_r;function _r(i,t,e){i instanceof RegExp&&(i=Mr(i,e)),t instanceof RegExp&&(t=Mr(t,e));var s=$r(i,t,e);return s&&{start:s[0],end:s[1],pre:e.slice(0,s[0]),body:e.slice(s[0]+i.length,s[1]),post:e.slice(s[1]+t.length)}}function Mr(i,t){var e=t.match(i);return e?e[0]:null}_r.range=$r;function $r(i,t,e){var s,r,n,o,a,c=e.indexOf(i),l=e.indexOf(t,c+1),h=c;if(c>=0&&l>0){if(i===t)return[c,l];for(s=[],n=e.length;h>=0&&!a;)h==c?(s.push(h),c=e.indexOf(i,h+1)):s.length==1?a=[s.pop(),l]:(r=s.pop(),r<n&&(n=r,o=l),l=e.indexOf(t,h+1)),h=c<l&&c>=0?c:l;s.length&&(a=[n,o])}return a}});var Yr=Zi((Su,Jr)=>{var Ur=Br();Jr.exports=Ia;var zr="\0SLASH"+Math.random()+"\0",Gr="\0OPEN"+Math.random()+"\0",di="\0CLOSE"+Math.random()+"\0",Vr="\0COMMA"+Math.random()+"\0",Kr="\0PERIOD"+Math.random()+"\0";function ui(i){return parseInt(i,10)==i?parseInt(i,10):i.charCodeAt(0)}function ka(i){return i.split("\\\\").join(zr).split("\\{").join(Gr).split("\\}").join(di).split("\\,").join(Vr).split("\\.").join(Kr)}function Da(i){return i.split(zr).join("\\").split(Gr).join("{").split(di).join("}").split(Vr).join(",").split(Kr).join(".")}function Hr(i){if(!i)return[""];var t=[],e=Ur("{","}",i);if(!e)return i.split(",");var s=e.pre,r=e.body,n=e.post,o=s.split(",");o[o.length-1]+="{"+r+"}";var a=Hr(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function Ia(i){return i?(i.substr(0,2)==="{}"&&(i="\\{\\}"+i.substr(2)),Fe(ka(i),!0).map(Da)):[]}function Fa(i){return"{"+i+"}"}function ja(i){return/^-?0\d/.test(i)}function La(i,t){return i<=t}function Pa(i,t){return i>=t}function Fe(i,t){var e=[],s=Ur("{","}",i);if(!s)return[i];var r=s.pre,n=s.post.length?Fe(s.post,!1):[""];if(/\$$/.test(s.pre))for(var o=0;o<n.length;o++){var a=r+"{"+s.body+"}"+n[o];e.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),h=c||l,f=s.body.indexOf(",")>=0;if(!h&&!f)return s.post.match(/,.*\}/)?(i=s.pre+"{"+s.body+di+s.post,Fe(i)):[i];var d;if(h)d=s.body.split(/\.\./);else if(d=Hr(s.body),d.length===1&&(d=Fe(d[0],!1).map(Fa),d.length===1))return n.map(function(mt){return s.pre+d[0]+mt});var g;if(h){var S=ui(d[0]),u=ui(d[1]),p=Math.max(d[0].length,d[1].length),m=d.length==3?Math.abs(ui(d[2])):1,w=La,x=u<S;x&&(m*=-1,w=Pa);var E=d.some(ja);g=[];for(var T=S;w(T,u);T+=m){var C;if(l)C=String.fromCharCode(T),C==="\\"&&(C="");else if(C=String(T),E){var L=p-C.length;if(L>0){var st=new Array(L+1).join("0");T<0?C="-"+st+C.slice(1):C=st+C}}g.push(C)}}else{g=[];for(var K=0;K<d.length;K++)g.push.apply(g,Fe(d[K],!1))}for(var K=0;K<g.length;K++)for(var o=0;o<n.length;o++){var a=r+g[K]+n[o];(!t||h||a)&&e.push(a)}}return e}});import{existsSync as Ne,promises as qt}from"fs";import Nt from"path";import tr from"path";import{createMatchPath as Do}from"tsconfig-paths";async function Ee(i,t){return Do(t.absoluteBaseUrl,t.paths)(i,void 0,()=>!0,[".ts",".tsx"])}import{cosmiconfig as Io}from"cosmiconfig";import{loadConfig as Fo}from"tsconfig-paths";import{z as A}from"zod";var er="@/components",sr="@/lib/utils",ir="app/globals.css",rr="tailwind.config.js";var jo=Io("components",{searchPlaces:["components.json"]}),Lo=A.object({name:A.string(),baseUrl:A.string().url()}),ve=A.object({$schema:A.string().optional(),style:A.string(),rsc:A.coerce.boolean().default(!1),tsx:A.coerce.boolean().default(!0),tailwind:A.object({config:A.string(),css:A.string(),baseColor:A.string(),cssVariables:A.boolean().default(!0),prefix:A.string().default("").optional()}),aliases:A.object({components:A.string(),utils:A.string(),ui:A.string().optional()}),registries:A.array(Lo).optional()}).strict(),Po=ve.extend({resolvedPaths:A.object({tailwindConfig:A.string(),tailwindCss:A.string(),utils:A.string(),components:A.string(),ui:A.string()})});async function Ot(i){let t=await Mo(i);return t?await Jt(i,t):null}async function Jt(i,t){let e=await Fo(i);if(e.resultType==="failed")throw new Error(`Failed to load ${t.tsx?"tsconfig":"jsconfig"}.json. ${e.message??""}`.trim());return Po.parse({...t,resolvedPaths:{tailwindConfig:tr.resolve(i,t.tailwind.config),tailwindCss:tr.resolve(i,t.tailwind.css),utils:await Ee(t.aliases.utils,e),components:await Ee(t.aliases.components,e),ui:t.aliases.ui?await Ee(t.aliases.ui,e):await Ee(t.aliases.components,e)}})}async function Mo(i){try{let t=await jo.search(i);return t?ve.parse(t.config):null}catch{throw new Error(`Invalid configuration found in ${i}/components.json.`)}}import{detect as _o}from"@antfu/ni";async function Te(i){let t=await _o({programmatic:!0,cwd:i});return t==="yarn@berry"?"yarn":t==="pnpm@6"?"pnpm":t==="bun"?"bun":t??"npm"}import es from"chalk";var v={error(...i){console.log(es.red(...i))},warn(...i){console.log(es.yellow(...i))},info(...i){console.log(es.cyan(...i))},success(...i){console.log(es.green(...i))},break(){console.log("")}};function gt(i){typeof i=="string"&&(v.error(i),process.exit(1)),i instanceof Error&&(v.error(i.message),process.exit(1)),v.error("Something went wrong. Please try again."),process.exit(1)}import Wo from"path";import{z as b}from"zod";var Ce=["components:ui","components:component","components:example","components:page","components:blocks"],Fh=b.enum(Ce),nr=b.object({name:b.string(),dependencies:b.array(b.string()).optional(),devDependencies:b.array(b.string()).optional(),registryDependencies:b.array(b.string()).optional(),files:b.array(b.string()),type:b.enum(Ce)}),or=b.array(b.object({name:b.string(),dependencies:b.array(b.string()).optional(),devDependencies:b.array(b.string()).optional(),registryDependencies:b.array(b.string()).optional(),files:b.array(b.string()),type:b.enum(Ce)})),ar=b.array(nr),$o=nr.extend({files:b.array(b.object({name:b.string(),path:b.string().optional(),content:b.string()}))}),cr=b.array($o),lr=b.array(b.object({name:b.string(),label:b.string()})),hr=b.object({inlineColors:b.object({light:b.record(b.string(),b.string()),dark:b.record(b.string(),b.string())}),cssVars:b.object({light:b.record(b.string(),b.string()),dark:b.record(b.string(),b.string())}),inlineColorsTemplate:b.string(),cssVarsTemplate:b.string()});import{HttpsProxyAgent as Bo}from"https-proxy-agent";import Uo from"node-fetch";var ss=process.env.COMPONENTS_REGISTRY_URL??"https://ui.shadcn.com",zo=process.env.https_proxy?new Bo(process.env.https_proxy):void 0;function ti(i){ss=i}async function is(){try{let[i]=await ns(["index.json"]);return ar.parse(i)}catch{throw new Error("Failed to fetch components from registry.")}}async function ei(){try{let[i]=await ns(["styles/index.json"]);return lr.parse(i)}catch{throw new Error("Failed to fetch styles from registry.")}}async function si(){return[{name:"slate",label:"Slate"},{name:"gray",label:"Gray"},{name:"zinc",label:"Zinc"},{name:"neutral",label:"Neutral"},{name:"stone",label:"Stone"}]}async function Yt(i){try{let[t]=await ns([`colors/${i}.json`]);return hr.parse(t)}catch{throw new Error("Failed to fetch base color from registry.")}}async function rs(i,t){let e=[];for(let s of t){let r=i.find(n=>n.name===s);if(r&&(e.push(r),r.registryDependencies)){let n=await rs(i,r.registryDependencies);e.push(...n)}}return e.filter((s,r,n)=>n.findIndex(o=>o.name===s.name)===r)}async function Ae(i,t,e=ss){try{let s=t.map(n=>`styles/${i}/${n.name}.json`),r=await ns(s);return cr.parse(r)}catch{throw new Error("Failed to fetch tree from registry.")}}async function Re(i,t,e){if(e)return e;if(t.type==="components:ui"&&i.aliases.ui)return i.resolvedPaths.ui;let[s,r]=t.type.split(":");return s in i.resolvedPaths?Wo.join(i.resolvedPaths[s],r):null}async function ns(i){try{return await Promise.all(i.map(async e=>await(await Uo(`${ss}/registry/${e}`,{agent:zo})).json()))}catch{throw new Error(`Failed to fetch registry from ${ss}.`)}}import{promises as Zo}from"fs";import{tmpdir as Qo}from"os";import yr from"path";import{SyntaxKind as Go}from"ts-morph";var fr=async({sourceFile:i,config:t,baseColor:e})=>(t.tailwind?.cssVariables||!e?.inlineColors||i.getDescendantsOfKind(Go.StringLiteral).forEach(s=>{let r=s.getText();if(r){let n=Ko(r.replace(/"/g,""),e.inlineColors);s.replaceWithText(`"${n.trim()}"`)}}),i);function ii(i){if(!i.includes("/")&&!i.includes(":"))return[null,i,null];let t=[],[e,s]=i.split("/");if(!e.includes(":"))return[null,e,s];let r=e.split(":"),n=r.pop(),o=r.join(":");return t.push(o??null,n??null,s??null),t}var Vo=["bg-","text-","border-","ring-offset-","ring-"];function Ko(i,t){i.includes(" border ")&&(i=i.replace(" border "," border border-border "));let e=i.split(" "),s=new Set,r=new Set;for(let n of e){let[o,a,c]=ii(n),l=Vo.find(f=>a?.startsWith(f));if(!l){s.has(n)||s.add(n);continue}let h=a?.replace(l,"");if(h&&h in t.light){s.add([o,`${l}${t.light[h]}`].filter(Boolean).join(":")+(c?`/${c}`:"")),r.add(["dark",o,`${l}${t.dark[h]}`].filter(Boolean).join(":")+(c?`/${c}`:""));continue}s.has(n)||s.add(n)}return[...Array.from(s),...Array.from(r)].join(" ").trim()}var ur=async({sourceFile:i,config:t})=>{let e=i.getImportDeclarations();for(let s of e){let r=s.getModuleSpecifierValue();r.startsWith("@/registry/")&&(t.aliases.ui?s.setModuleSpecifier(r.replace(/^@\/registry\/[^/]+\/ui/,t.aliases.ui)):s.setModuleSpecifier(r.replace(/^@\/registry\/[^/]+/,t.aliases.components))),r=="@/lib/utils"&&s.getNamedImports().find(a=>a.getName()==="cn")&&s.setModuleSpecifier(r.replace(/^@\/lib\/utils/,t.aliases.utils))}return i};import{transformFromAstSync as Ho}from"@babel/core";import{parse as Jo}from"@babel/parser";import Yo from"@babel/plugin-transform-typescript";import*as os from"recast";var qo={sourceType:"module",allowImportExportEverywhere:!0,allowReturnOutsideFunction:!0,startLine:1,tokens:!0,plugins:["asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","classStaticBlock","decimal","decorators-legacy","doExpressions","dynamicImport","exportDefaultFrom","exportNamespaceFrom","functionBind","functionSent","importAssertions","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{proposal:"minimal"}],["recordAndTuple",{syntaxType:"hash"}],"throwExpressions","topLevelAwait","v8intrinsic","typescript","jsx"]},dr=async({sourceFile:i,config:t})=>{let e=i.getFullText();if(t.tsx)return e;let s=os.parse(e,{parser:{parse:n=>Jo(n,qo)}}),r=Ho(s,e,{cloneInputAst:!1,code:!1,ast:!0,plugins:[Yo],configFile:!1});if(!r||!r.ast)throw new Error("Failed to transform JSX");return os.print(r.ast).code};import{SyntaxKind as Xo}from"ts-morph";var pr=async({sourceFile:i,config:t})=>{if(t.rsc)return i;let e=i.getFirstChildByKind(Xo.ExpressionStatement);return e?.getText()==='"use client"'&&e.remove(),i};import{Project as ta,ScriptKind as ea}from"ts-morph";import{SyntaxKind as k}from"ts-morph";var mr=async({sourceFile:i,config:t})=>(t.tailwind?.prefix&&(i.getDescendantsOfKind(k.CallExpression).filter(e=>e.getExpression().getText()==="cva").forEach(e=>{if(e.getArguments()[0]?.isKind(k.StringLiteral)){let s=e.getArguments()[0];s&&s.replaceWithText(`"${yt(s.getText()?.replace(/"/g,""),t.tailwind.prefix)}"`)}e.getArguments()[1]?.isKind(k.ObjectLiteralExpression)&&e.getArguments()[1]?.getDescendantsOfKind(k.PropertyAssignment).find(s=>s.getName()==="variants")?.getDescendantsOfKind(k.PropertyAssignment).forEach(s=>{s.getDescendantsOfKind(k.PropertyAssignment).forEach(r=>{let n=r.getInitializerIfKind(k.StringLiteral);n&&n?.replaceWithText(`"${yt(n.getText()?.replace(/"/g,""),t.tailwind.prefix)}"`)})})}),i.getDescendantsOfKind(k.JsxAttribute).forEach(e=>{if(e.getName()==="className"){if(e.getInitializer()?.isKind(k.StringLiteral)){let s=e.getInitializer();s&&s.replaceWithText(`"${yt(s.getText()?.replace(/"/g,""),t.tailwind.prefix)}"`)}if(e.getInitializer()?.isKind(k.JsxExpression)){let s=e.getInitializer()?.getDescendantsOfKind(k.CallExpression).find(r=>r.getExpression().getText()==="cn");s&&s.getArguments().forEach(r=>{(r.isKind(k.ConditionalExpression)||r.isKind(k.BinaryExpression))&&r.getChildrenOfKind(k.StringLiteral).forEach(n=>{n.replaceWithText(`"${yt(n.getText()?.replace(/"/g,""),t.tailwind.prefix)}"`)}),r.isKind(k.StringLiteral)&&r.replaceWithText(`"${yt(r.getText()?.replace(/"/g,""),t.tailwind.prefix)}"`)})}}e.getName()==="classNames"&&e.getInitializer()?.isKind(k.JsxExpression)&&e.getDescendantsOfKind(k.PropertyAssignment).forEach(s=>{if(s.getInitializer()?.isKind(k.CallExpression)){let r=s.getInitializerIfKind(k.CallExpression);r&&r.getArguments().forEach(n=>{n.isKind(k.ConditionalExpression)&&n.getChildrenOfKind(k.StringLiteral).forEach(o=>{o.replaceWithText(`"${yt(o.getText()?.replace(/"/g,""),t.tailwind.prefix)}"`)}),n.isKind(k.StringLiteral)&&n.replaceWithText(`"${yt(n.getText()?.replace(/"/g,""),t.tailwind.prefix)}"`)})}if(s.getInitializer()?.isKind(k.StringLiteral)&&s.getName()!=="variant"){let r=s.getInitializer();r&&r.replaceWithText(`"${yt(r.getText()?.replace(/"/g,""),t.tailwind.prefix)}"`)}})})),i);function yt(i,t=""){let e=i.split(" "),s=[];for(let r of e){let[n,o,a]=ii(r);n?a?s.push(`${n}:${t}${o}/${a}`):s.push(`${n}:${t}${o}`):a?s.push(`${t}${o}/${a}`):s.push(`${t}${o}`)}return s.join(" ")}function gr(i,t){let e=i.split(`
`);for(let s of e)if(s.includes("@apply")){let r=s.replace("@apply","").trim(),n=yt(r,t);i=i.replace(r,n)}return i}var sa=[ur,pr,fr,mr],ia=new ta({compilerOptions:{}});async function ra(i){let t=await Zo.mkdtemp(yr.join(Qo(),"shadcn-"));return yr.join(t,i)}async function Oe(i){let t=await ra(i.filename),e=ia.createSourceFile(t,i.raw,{scriptKind:ea.TSX});for(let s of sa)s({sourceFile:e,...i});return await dr({sourceFile:e,...i})}import ri from"chalk";import{Command as na}from"commander";import{execa as as}from"execa";import oa from"ora";import Xt from"prompts";import{z as kt}from"zod";var aa=kt.object({components:kt.array(kt.string()).optional(),yes:kt.boolean(),overwrite:kt.boolean(),cwd:kt.string(),all:kt.boolean(),path:kt.string().optional()}),wr=new na().name("add").description("add a component to your project").argument("[components...]","the components to add").option("-y, --yes","skip confirmation prompt.",!0).option("-o, --overwrite","overwrite existing files.",!1).option("-r, --registry <registry>","the registry to use.","shadcn").option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).option("-a, --all","add all available components",!1).option("-p, --path <path>","the path to add the component to.").option("-t, --type <type>","the type of component to add. (ui, component, example). (default: ui)","ui").action(async(i,t)=>{let{registry:e,type:s}=t;try{if(s==="page"&&!t.path){let u=await Xt({type:"text",name:"path",initial:"src/app",message:"Enter the path where the page component should be added:",validate:p=>p.trim()===""?"Path can't be empty.":!0});u.path?t.path=u.path:(v.error("Path is required for page components. Exiting."),process.exit(1))}let r=aa.parse({components:i,...t}),n=Nt.resolve(r.cwd);Ne(n)||(v.error(`The path ${n} does not exist. Please try again.`),process.exit(1));let o=await Ot(n);if(o||(v.warn(`Configuration is missing. Please run ${ri.green("init")} to create a components.json file.`),process.exit(1)),o.registries?.length&&o.registries.length>1)if(e){let u=o.registries.find(p=>p.name===e);u||(v.error(`The registry ${e} does not exist. Please try again.`),process.exit(1)),ti(u.baseUrl)}else{let{registry:u}=await Xt({type:"select",name:"registry",message:"Select a registry",choices:o.registries.map(p=>({title:p.name,value:p.baseUrl}))});u||(v.error("No registry selected. Exiting."),process.exit(1)),ti(u)}let a=await is(),c=r.all?a.map(u=>u.name):r.components;if(!r.components?.length&&!r.all){let{components:u}=await Xt({type:"multiselect",name:"components",message:"Which components would you like to add?",hint:"Space to select. A to toggle all. Enter to submit.",instructions:!1,choices:a.filter(p=>p.type===`components:${s}`).map(p=>({title:p.name,value:p.name,selected:r.all?!0:r.components?.includes(p.name)}))});c=u}c?.length||(v.warn("No components selected. Exiting."),process.exit(0));let l=[],h=async u=>{let p=[];for(let m of u){let w=m.split("/").pop();w&&!c.includes(w)&&(p.includes(w)||p.push(w));let x=await rs(a,p);l=await Ae(o.style,x)}};for(let u of a)c.includes(u.name)&&u.registryDependencies&&await h(u.registryDependencies);let f=await rs(a,c),d=await Ae(o.style,f),g=await Yt(o.tailwind.baseColor);if(d.length||(v.warn("Selected components not found. Exiting."),process.exit(0)),!r.yes){let{proceed:u}=await Xt({type:"confirm",name:"proceed",message:"Ready to install components and dependencies. Proceed?",initial:!0});u||process.exit(0)}let S=oa("Installing components...").start();for(let u of l){S.text=`Installing ${u.name}...`;let p=await Re(o,u,void 0);if(!p)continue;if(Ne(p)||await qt.mkdir(p,{recursive:!0}),u.files.filter(x=>Ne(Nt.resolve(p,x.name))).length&&!r.overwrite)if(l.includes(u.name)){S.stop();let{overwrite:x}=await Xt({type:"confirm",name:"overwrite",message:`Component ${u.name} already exists. Would you like to overwrite?`,initial:!1});if(!x){v.info(`Skipped ${u.name}. To overwrite, run with the ${ri.green("--overwrite")} flag.`);continue}S.start(`Installing ${u.name}...`)}else continue;for(let x of u.files){let E=Nt.resolve(p,x.path?x.path:x.name),T=Nt.dirname(E);await qt.mkdir(T,{recursive:!0});let C=await Oe({filename:x.name,raw:x.content,config:o,baseColor:g});o.tsx||(E=E.replace(/\.tsx$/,".jsx"),E=E.replace(/\.ts$/,".js")),await qt.writeFile(E,C)}let w=await Te(n);u.dependencies?.length&&await as(w,[w==="npm"?"install":"add",...u.dependencies],{cwd:n}),u.devDependencies?.length&&await as(w,[w==="npm"?"install":"add","-D",...u.devDependencies],{cwd:n})}for(let u of d){S.text=`Installing ${u.name}...`;let p=await Re(o,u,r.path?Nt.resolve(n,r.path):void 0);if(!p)continue;if(Ne(p)||await qt.mkdir(p,{recursive:!0}),u.files.filter(x=>Ne(Nt.resolve(p,x.name))).length&&!r.overwrite)if(c.includes(u.name)){S.stop();let{overwrite:x}=await Xt({type:"confirm",name:"overwrite",message:`Component ${u.name} already exists. Would you like to overwrite?`,initial:!1});if(!x){v.info(`Skipped ${u.name}. To overwrite, run with the ${ri.green("--overwrite")} flag.`);continue}S.start(`Installing ${u.name}...`)}else continue;for(let x of u.files){let E=Nt.resolve(p,x.path?x.path:x.name),T=Nt.dirname(E);await qt.mkdir(T,{recursive:!0});let C=await Oe({filename:x.name,raw:x.content,config:o,baseColor:g});o.tsx||(E=E.replace(/\.tsx$/,".jsx"),E=E.replace(/\.ts$/,".js")),await qt.writeFile(E,C)}let w=await Te(n);u.dependencies?.length&&await as(w,[w==="npm"?"install":"add",...u.dependencies],{cwd:n}),u.devDependencies?.length&&await as(w,[w==="npm"?"install":"add","-D",...u.devDependencies],{cwd:n})}S.succeed("Done.")}catch(r){console.log(r),gt(r)}});import{existsSync as ni,promises as ca}from"fs";import oi from"path";import De from"chalk";import{Command as la}from"commander";import{diffLines as ha}from"diff";import{z as ke}from"zod";var fa=ke.object({component:ke.string().optional(),yes:ke.boolean(),cwd:ke.string(),path:ke.string().optional()}),Sr=new la().name("diff").description("check for updates against the registry").argument("[component]","the component name").option("-y, --yes","skip confirmation prompt.",!1).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).action(async(i,t)=>{try{let e=fa.parse({component:i,...t}),s=oi.resolve(e.cwd);ni(s)||(v.error(`The path ${s} does not exist. Please try again.`),process.exit(1));let r=await Ot(s);r||(v.warn(`Configuration is missing. Please run ${De.green("init")} to create a components.json file.`),process.exit(1));let n=await is();if(!e.component){let c=r.resolvedPaths.components,l=n.filter(f=>{for(let d of f.files){let g=oi.resolve(c,d);if(ni(g))return!0}return!1}),h=[];for(let f of l){let d=await xr(f,r);d.length&&h.push({name:f.name,changes:d})}h.length||(v.info("No updates found."),process.exit(0)),v.info("The following components have updates available:");for(let f of h){v.info(`- ${f.name}`);for(let d of f.changes)v.info(`  - ${d.filePath}`)}v.break(),v.info(`Run ${De.green("diff <component>")} to see the changes.`),process.exit(0)}let o=n.find(c=>c.name===e.component);o||(v.error(`The component ${De.green(e.component)} does not exist.`),process.exit(1));let a=await xr(o,r);a.length||(v.info(`No updates found for ${e.component}.`),process.exit(0));for(let c of a)v.info(`- ${c.filePath}`),await ua(c.patch),v.info("")}catch(e){gt(e)}});async function xr(i,t){let e=await Ae(t.style,[i]),s=await Yt(t.tailwind.baseColor),r=[];for(let n of e){let o=await Re(t,n);if(o)for(let a of n.files){let c=oi.resolve(o,a.name);if(!ni(c))continue;let l=await ca.readFile(c,"utf8"),h=await Oe({filename:a.name,raw:a.content,config:t,baseColor:s}),f=ha(h,l);f.length>1&&r.push({file:a.name,filePath:c,patch:f})}}return r}async function ua(i){i.forEach(t=>{if(t)return t.added?process.stdout.write(De.green(t.value)):t.removed?process.stdout.write(De.red(t.value)):process.stdout.write(t.value)})}import{existsSync as kr,promises as Zt}from"fs";import Qt from"path";import cs from"path";import ci from"fast-glob";import ai,{pathExists as da}from"fs-extra";import{loadConfig as pa}from"tsconfig-paths";var li=["**/node_modules/**",".next","public","dist","build"];async function br(i){let t=await Ot(i);if(t)return t;let e=await ma(i),s=await ga(i),r=await ya(i);if(!e||!s||!r)return null;let n=await wa(i),o={$schema:"https://ui.shadcn.com/schema.json",rsc:["next-app","next-app-src"].includes(e),tsx:n,style:"new-york",tailwind:{config:n?"tailwind.config.ts":"tailwind.config.js",baseColor:"zinc",css:s,cssVariables:!0,prefix:""},aliases:{utils:`${r}/lib/utils`,components:`${r}/components`},registries:[{name:"shadcn",baseUrl:"https://ui.shadcn.com"}]};return await Jt(i,o)}async function ma(i){if(!(await ci.glob("**/*",{cwd:i,deep:3,ignore:li})).find(n=>n.startsWith("next.config.")))return null;let s=await ai.pathExists(cs.resolve(i,"src"));return await ai.pathExists(cs.resolve(i,`${s?"src/":""}app`))?s?"next-app-src":"next-app":s?"next-pages-src":"next-pages"}async function ga(i){let t=await ci.glob("**/*.css",{cwd:i,deep:3,ignore:li});if(!t.length)return null;for(let e of t)if((await ai.readFile(cs.resolve(i,e),"utf8")).includes("@tailwind base"))return e;return null}async function ya(i){let t=await pa(i);if(t?.resultType==="failed"||!t?.paths)return null;for(let[e,s]of Object.entries(t.paths))if(s.includes("./*")||s.includes("./src/*"))return e.at(0);return null}async function wa(i){return da(cs.resolve(i,"tsconfig.json"))}async function Er(i){if(!(await ci.glob("tailwind.config.*",{cwd:i,deep:3,ignore:li})).length)throw new Error("Tailwind CSS is not installed. Visit https://tailwindcss.com/docs/installation to get started.");return!0}var vr=`import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
`,Tr=`import { clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs) {
  return twMerge(clsx(inputs))
}
`,Cr=`/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ["class"],
  content: [
    './pages/**/*.{<%- extension %>,<%- extension %>x}',
    './components/**/*.{<%- extension %>,<%- extension %>x}',
    './app/**/*.{<%- extension %>,<%- extension %>x}',
    './src/**/*.{<%- extension %>,<%- extension %>x}',
  ],
  prefix: "<%- prefix %>",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
}`,Ar=`/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ["class"],
  content: [
    './pages/**/*.{<%- extension %>,<%- extension %>x}',
    './components/**/*.{<%- extension %>,<%- extension %>x}',
    './app/**/*.{<%- extension %>,<%- extension %>x}',
    './src/**/*.{<%- extension %>,<%- extension %>x}',
  ],
  prefix: "<%- prefix %>",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
}`,Rr=`import type { Config } from "tailwindcss"

const config = {
  darkMode: ["class"],
  content: [
    './pages/**/*.{<%- extension %>,<%- extension %>x}',
    './components/**/*.{<%- extension %>,<%- extension %>x}',
    './app/**/*.{<%- extension %>,<%- extension %>x}',
    './src/**/*.{<%- extension %>,<%- extension %>x}',
  ],
  prefix: "<%- prefix %>",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
} satisfies Config

export default config`,Or=`import type { Config } from "tailwindcss"

const config = {
  darkMode: ["class"],
  content: [
    './pages/**/*.{<%- extension %>,<%- extension %>x}',
    './components/**/*.{<%- extension %>,<%- extension %>x}',
    './app/**/*.{<%- extension %>,<%- extension %>x}',
    './src/**/*.{<%- extension %>,<%- extension %>x}',
	],
  prefix: "<%- prefix %>",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
} satisfies Config

export default config`;import fi from"chalk";import{Command as Sa}from"commander";import{execa as ba}from"execa";import Ea from"lodash.template";import hs from"ora";import hi from"prompts";import{z as ls}from"zod";var va=["tailwindcss-animate","class-variance-authority","clsx","tailwind-merge"],Ta=ls.object({cwd:ls.string(),yes:ls.boolean(),defaults:ls.boolean()}),Dr=new Sa().name("init").description("initialize your project and install dependencies").option("-y, --yes","skip confirmation prompt.",!1).option("-d, --defaults,","use default configuration.",!1).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).action(async i=>{try{let t=Ta.parse(i),e=Qt.resolve(t.cwd);kr(e)||(v.error(`The path ${e} does not exist. Please try again.`),process.exit(1)),Er(e);let s=await br(e);if(s){let r=await Aa(e,s,i.defaults);await Nr(e,r)}else{let r=await Ot(e),n=await Ca(e,r,t.yes);await Nr(e,n)}v.info(""),v.info(`${fi.green("Success!")} Project initialization completed. You may now add components.`),v.info("")}catch(t){gt(t)}});async function Ca(i,t=null,e=!1){let s=h=>fi.cyan(h),r=await ei(),n=await si(),o=await hi([{type:"toggle",name:"typescript",message:`Would you like to use ${s("TypeScript")} (recommended)?`,initial:t?.tsx??!0,active:"yes",inactive:"no"},{type:"select",name:"style",message:`Which ${s("style")} would you like to use?`,choices:r.map(h=>({title:h.label,value:h.name}))},{type:"select",name:"tailwindBaseColor",message:`Which color would you like to use as ${s("base color")}?`,choices:n.map(h=>({title:h.label,value:h.name}))},{type:"text",name:"tailwindCss",message:`Where is your ${s("global CSS")} file?`,initial:t?.tailwind.css??ir},{type:"toggle",name:"tailwindCssVariables",message:`Would you like to use ${s("CSS variables")} for colors?`,initial:t?.tailwind.cssVariables??!0,active:"yes",inactive:"no"},{type:"text",name:"tailwindPrefix",message:`Are you using a custom ${s("tailwind prefix eg. tw-")}? (Leave blank if not)`,initial:""},{type:"text",name:"tailwindConfig",message:`Where is your ${s("tailwind.config.js")} located?`,initial:t?.tailwind.config??rr},{type:"text",name:"components",message:`Configure the import alias for ${s("components")}:`,initial:t?.aliases.components??er},{type:"text",name:"utils",message:`Configure the import alias for ${s("utils")}:`,initial:t?.aliases.utils??sr},{type:"toggle",name:"rsc",message:`Are you using ${s("React Server Components")}?`,initial:t?.rsc??!0,active:"yes",inactive:"no"}]),a=ve.parse({$schema:"https://ui.shadcn.com/schema.json",style:o.style,tailwind:{config:o.tailwindConfig,css:o.tailwindCss,baseColor:o.tailwindBaseColor,cssVariables:o.tailwindCssVariables,prefix:o.tailwindPrefix},rsc:o.rsc,tsx:o.typescript,aliases:{utils:o.utils,components:o.components},registries:[{name:"shadcn",baseUrl:process.env.COMPONENTS_REGISTRY_URL??"https://ui.shadcn.com"},{name:"shadxn",baseUrl:"https://ui.shadxn.com"},{name:"aceternity",baseUrl:"https://ui.aceternity.com"}]});if(!e){let{proceed:h}=await hi({type:"confirm",name:"proceed",message:`Write configuration to ${s("components.json")}. Proceed?`,initial:!0});h||process.exit(0)}v.info("");let c=hs("Writing components.json...").start(),l=Qt.resolve(i,"components.json");return await Zt.writeFile(l,JSON.stringify(a,null,2),"utf8"),c.succeed(),await Jt(i,a)}async function Aa(i,t,e=!1){let s=h=>fi.cyan(h),r=t.style,n=t.tailwind.baseColor,o=t.tailwind.cssVariables;if(!e){let h=await ei(),f=await si(),d=await hi([{type:"select",name:"style",message:`Which ${s("style")} would you like to use?`,choices:h.map(g=>({title:g.label,value:g.name}))},{type:"select",name:"tailwindBaseColor",message:`Which color would you like to use as ${s("base color")}?`,choices:f.map(g=>({title:g.label,value:g.name}))},{type:"toggle",name:"tailwindCssVariables",message:`Would you like to use ${s("CSS variables")} for colors?`,initial:t?.tailwind.cssVariables,active:"yes",inactive:"no"}]);r=d.style,n=d.tailwindBaseColor,o=d.tailwindCssVariables}let a=ve.parse({$schema:t?.$schema,style:r,tailwind:{...t?.tailwind,baseColor:n,cssVariables:o},rsc:t?.rsc,tsx:t?.tsx,aliases:t?.aliases,registries:[{name:"shadcn",baseUrl:"https://ui.shadcn.com"},{name:"shadxn",baseUrl:"https://ui.shadxn.com"}]});v.info("");let c=hs("Writing components.json...").start(),l=Qt.resolve(i,"components.json");return await Zt.writeFile(l,JSON.stringify(a,null,2),"utf8"),c.succeed(),await Jt(i,a)}async function Nr(i,t){let e=hs("Initializing project...")?.start();for(let[h,f]of Object.entries(t.resolvedPaths)){let d=Qt.extname(f)?Qt.dirname(f):f;h==="utils"&&f.endsWith("/utils")&&(d=d.replace(/\/utils$/,"")),kr(d)||await Zt.mkdir(d,{recursive:!0})}let s=t.tsx?"ts":"js",r=Qt.extname(t.resolvedPaths.tailwindConfig),n;r===".ts"?n=t.tailwind.cssVariables?Or:Rr:n=t.tailwind.cssVariables?Ar:Cr,await Zt.writeFile(t.resolvedPaths.tailwindConfig,Ea(n)({extension:s,prefix:t.tailwind.prefix}),"utf8");let o=await Yt(t.tailwind.baseColor);o&&await Zt.writeFile(t.resolvedPaths.tailwindCss,t.tailwind.cssVariables?t.tailwind.prefix?gr(o.cssVarsTemplate,t.tailwind.prefix):o.cssVarsTemplate:o.inlineColorsTemplate,"utf8"),await Zt.writeFile(`${t.resolvedPaths.utils}.${s}`,s==="ts"?vr:Tr,"utf8"),e?.succeed();let a=hs("Installing dependencies...")?.start(),c=await Te(i),l=[...va,t.style==="new-york"?"@radix-ui/react-icons":"lucide-react"];await ba(c,[c==="npm"?"install":"add",...l],{cwd:i}),a?.succeed()}import{Command as Ql}from"commander";import*as Xs from"fs-extra";import*as M from"fs";import N from"path";import Xi from"lodash.template";var Ir=i=>{Lr(i);let{glob:t,...e}=i;if(!t)return e;let s=t===!0?i.signal?{signal:i.signal}:{}:i.signal?{signal:i.signal,...t}:t;return{...e,glob:{...s,absolute:!0,withFileTypes:!1}}},Fr=(i={})=>Ir(i),jr=(i={})=>Ir(i);import{parse as Pr,resolve as Ra}from"path";import{inspect as Oa}from"util";var at=process.env.__TESTING_RIMRAF_PLATFORM__||process.platform;var Na=(i,t={})=>{let e=typeof i;if(e!=="string"){let r=i&&e==="object"&&i.constructor,o=`The "path" argument must be of type string. Received ${r&&r.name?`an instance of ${r.name}`:e==="object"?Oa(i):`type ${e} ${i}`}`;throw Object.assign(new TypeError(o),{path:i,code:"ERR_INVALID_ARG_TYPE"})}if(/\0/.test(i)){let r="path must be a string without null bytes";throw Object.assign(new TypeError(r),{path:i,code:"ERR_INVALID_ARG_VALUE"})}i=Ra(i);let{root:s}=Pr(i);if(i===s&&t.preserveRoot!==!1){let r="refusing to remove root directory without preserveRoot:false";throw Object.assign(new Error(r),{path:i,code:"ERR_PRESERVE_ROOT"})}if(at==="win32"){let r=/[*|"<>?:]/,{root:n}=Pr(i);if(r.test(i.substring(n.length)))throw Object.assign(new Error("Illegal characters in path."),{path:i,code:"EINVAL"})}return i},Ie=Na;var on=ko(Yr(),1);var je=i=>{if(typeof i!="string")throw new TypeError("invalid pattern");if(i.length>65536)throw new TypeError("pattern is too long")};var Ma={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Le=i=>i.replace(/[[\]\\-]/g,"\\$&"),_a=i=>i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),qr=i=>i.join(""),Xr=(i,t)=>{let e=t;if(i.charAt(e)!=="[")throw new Error("not in a brace expression");let s=[],r=[],n=e+1,o=!1,a=!1,c=!1,l=!1,h=e,f="";t:for(;n<i.length;){let u=i.charAt(n);if((u==="!"||u==="^")&&n===e+1){l=!0,n++;continue}if(u==="]"&&o&&!c){h=n+1;break}if(o=!0,u==="\\"&&!c){c=!0,n++;continue}if(u==="["&&!c){for(let[p,[m,w,x]]of Object.entries(Ma))if(i.startsWith(p,n)){if(f)return["$.",!1,i.length-e,!0];n+=p.length,x?r.push(m):s.push(m),a=a||w;continue t}}if(c=!1,f){u>f?s.push(Le(f)+"-"+Le(u)):u===f&&s.push(Le(u)),f="",n++;continue}if(i.startsWith("-]",n+1)){s.push(Le(u+"-")),n+=2;continue}if(i.startsWith("-",n+1)){f=u,n+=2;continue}s.push(Le(u)),n++}if(h<n)return["",!1,0,!1];if(!s.length&&!r.length)return["$.",!1,i.length-e,!0];if(r.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!l){let u=s[0].length===2?s[0].slice(-1):s[0];return[_a(u),!1,h-e,!1]}let d="["+(l?"^":"")+qr(s)+"]",g="["+(l?"":"^")+qr(r)+"]";return[s.length&&r.length?"("+d+"|"+g+")":s.length?d:g,a,h-e,!0]};var ct=(i,{windowsPathsNoEscape:t=!1}={})=>t?i.replace(/\[([^\/\\])\]/g,"$1"):i.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var $a=new Set(["!","?","+","*","@"]),Zr=i=>$a.has(i),Wa="(?!\\.\\.?(?:$|/))",pi="(?!\\.)",Ba=new Set(["[","."]),Ua=new Set(["..","."]),za=new Set("().*{}+?[]^$\\!"),Ga=i=>i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),mi="[^/]",Qr=mi+"*?",tn=mi+"+?",P,_,wt,O,j,Dt,Wt,It,it,Bt,Pe,us,en,te,fs,ds,sn,X=class{constructor(t,e,s={}){z(this,us);Qi(this,"type");z(this,P,void 0);z(this,_,void 0);z(this,wt,!1);z(this,O,[]);z(this,j,void 0);z(this,Dt,void 0);z(this,Wt,void 0);z(this,It,!1);z(this,it,void 0);z(this,Bt,void 0);z(this,Pe,!1);this.type=t,t&&R(this,_,!0),R(this,j,e),R(this,P,y(this,j)?y(y(this,j),P):this),R(this,it,y(this,P)===this?s:y(y(this,P),it)),R(this,Wt,y(this,P)===this?[]:y(y(this,P),Wt)),t==="!"&&!y(y(this,P),It)&&y(this,Wt).push(this),R(this,Dt,y(this,j)?y(y(this,j),O).length:0)}get hasMagic(){if(y(this,_)!==void 0)return y(this,_);for(let t of y(this,O))if(typeof t!="string"&&(t.type||t.hasMagic))return R(this,_,!0);return y(this,_)}toString(){return y(this,Bt)!==void 0?y(this,Bt):this.type?R(this,Bt,this.type+"("+y(this,O).map(t=>String(t)).join("|")+")"):R(this,Bt,y(this,O).map(t=>String(t)).join(""))}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof X&&y(e,j)===this))throw new Error("invalid part: "+e);y(this,O).push(e)}}toJSON(){let t=this.type===null?y(this,O).slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...y(this,O).map(e=>e.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===y(this,P)||y(y(this,P),It)&&y(this,j)?.type==="!")&&t.push({}),t}isStart(){if(y(this,P)===this)return!0;if(!y(this,j)?.isStart())return!1;if(y(this,Dt)===0)return!0;let t=y(this,j);for(let e=0;e<y(this,Dt);e++){let s=y(t,O)[e];if(!(s instanceof X&&s.type==="!"))return!1}return!0}isEnd(){if(y(this,P)===this||y(this,j)?.type==="!")return!0;if(!y(this,j)?.isEnd())return!1;if(!this.type)return y(this,j)?.isEnd();let t=y(this,j)?y(y(this,j),O).length:0;return y(this,Dt)===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){let e=new X(this.type,t);for(let s of y(this,O))e.copyIn(s);return e}static fromGlob(t,e={}){var r;let s=new X(null,void 0,e);return Ht(r=X,te,fs).call(r,t,s,0,e),s}toMMPattern(){if(this!==y(this,P))return y(this,P).toMMPattern();let t=this.toString(),[e,s,r,n]=this.toRegExpSource();if(!(r||y(this,_)||y(this,it).nocase&&!y(this,it).nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return s;let a=(y(this,it).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp(`^${e}$`,a),{_src:e,_glob:t})}toRegExpSource(){if(y(this,P)===this&&Ht(this,us,en).call(this),!this.type){let r=this.isStart()&&this.isEnd(),n=y(this,O).map(l=>{var S;let[h,f,d,g]=typeof l=="string"?Ht(S=X,ds,sn).call(S,l,y(this,_),r):l.toRegExpSource();return R(this,_,y(this,_)||d),R(this,wt,y(this,wt)||g),h}).join(""),o="";if(this.isStart()&&typeof y(this,O)[0]=="string"&&!(y(this,O).length===1&&Ua.has(y(this,O)[0]))){let h=Ba,f=y(this,it).dot&&h.has(n.charAt(0))||n.startsWith("\\.")&&h.has(n.charAt(2))||n.startsWith("\\.\\.")&&h.has(n.charAt(4)),d=!y(this,it).dot&&h.has(n.charAt(0));o=f?Wa:d?pi:""}let a="";return this.isEnd()&&y(y(this,P),It)&&y(this,j)?.type==="!"&&(a="(?:$|\\/)"),[o+n+a,ct(n),R(this,_,!!y(this,_)),y(this,wt)]}let t=this.type==="!"?"(?:(?!(?:":"(?:",e=y(this,O).map(r=>{if(typeof r=="string")throw new Error("string type in extglob ast??");let[n,o,a,c]=r.toRegExpSource();return R(this,wt,y(this,wt)||c),n}).filter(r=>!(this.isStart()&&this.isEnd())||!!r).join("|");if(this.isStart()&&this.isEnd()&&!e&&this.type!=="!"){let r=this.toString();return R(this,O,[r]),this.type=null,R(this,_,void 0),[r,ct(this.toString()),!1,!1]}let s="";if(this.type==="!"&&y(this,Pe))s=(this.isStart()&&!y(this,it).dot?pi:"")+tn;else{let r=this.type==="!"?"))"+(this.isStart()&&!y(this,it).dot?pi:"")+Qr+")":this.type==="@"?")":`)${this.type}`;s=t+e+r}return[s,ct(e),R(this,_,!!y(this,_)),y(this,wt)]}},Ft=X;P=new WeakMap,_=new WeakMap,wt=new WeakMap,O=new WeakMap,j=new WeakMap,Dt=new WeakMap,Wt=new WeakMap,It=new WeakMap,it=new WeakMap,Bt=new WeakMap,Pe=new WeakMap,us=new WeakSet,en=function(){if(this!==y(this,P))throw new Error("should only call on root");if(y(this,It))return this;this.toString(),R(this,It,!0);let t;for(;t=y(this,Wt).pop();){if(t.type!=="!")continue;let e=t,s=y(e,j);for(;s;){for(let r=y(e,Dt)+1;!s.type&&r<y(s,O).length;r++)for(let n of y(t,O)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(y(s,O)[r])}e=s,s=y(e,j)}}return this},te=new WeakSet,fs=function(t,e,s,r){var g,S;let n=!1,o=!1,a=-1,c=!1;if(e.type===null){let u=s,p="";for(;u<t.length;){let m=t.charAt(u++);if(n||m==="\\"){n=!n,p+=m;continue}if(o){u===a+1?(m==="^"||m==="!")&&(c=!0):m==="]"&&!(u===a+2&&c)&&(o=!1),p+=m;continue}else if(m==="["){o=!0,a=u,c=!1,p+=m;continue}if(!r.noext&&Zr(m)&&t.charAt(u)==="("){e.push(p),p="";let w=new X(m,e);u=Ht(g=X,te,fs).call(g,t,w,u,r),e.push(w);continue}p+=m}return e.push(p),u}let l=s+1,h=new X(null,e),f=[],d="";for(;l<t.length;){let u=t.charAt(l++);if(n||u==="\\"){n=!n,d+=u;continue}if(o){l===a+1?(u==="^"||u==="!")&&(c=!0):u==="]"&&!(l===a+2&&c)&&(o=!1),d+=u;continue}else if(u==="["){o=!0,a=l,c=!1,d+=u;continue}if(Zr(u)&&t.charAt(l)==="("){h.push(d),d="";let p=new X(u,h);h.push(p),l=Ht(S=X,te,fs).call(S,t,p,l,r);continue}if(u==="|"){h.push(d),d="",f.push(h),h=new X(null,e);continue}if(u===")")return d===""&&y(e,O).length===0&&R(e,Pe,!0),h.push(d),d="",e.push(...f,h),l;d+=u}return e.type=null,R(e,_,void 0),R(e,O,[t.substring(s-1)]),l},ds=new WeakSet,sn=function(t,e,s=!1){let r=!1,n="",o=!1;for(let a=0;a<t.length;a++){let c=t.charAt(a);if(r){r=!1,n+=(za.has(c)?"\\":"")+c;continue}if(c==="\\"){a===t.length-1?n+="\\\\":r=!0;continue}if(c==="["){let[l,h,f,d]=Xr(t,a);if(f){n+=l,o=o||h,a+=f-1,e=e||d;continue}}if(c==="*"){s&&t==="*"?n+=tn:n+=Qr,e=!0;continue}if(c==="?"){n+=mi,e=!0;continue}n+=Ga(c)}return[n,ct(t),!!e,o]},z(Ft,te),z(Ft,ds);var ee=(i,{windowsPathsNoEscape:t=!1}={})=>t?i.replace(/[?*()[\]]/g,"[$&]"):i.replace(/[?*()[\]\\]/g,"\\$&");var Y=(i,t,e={})=>(je(t),!e.nocomment&&t.charAt(0)==="#"?!1:new tt(t,e).match(i));var Va=/^\*+([^+@!?\*\[\(]*)$/,Ka=i=>t=>!t.startsWith(".")&&t.endsWith(i),Ha=i=>t=>t.endsWith(i),Ja=i=>(i=i.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(i)),Ya=i=>(i=i.toLowerCase(),t=>t.toLowerCase().endsWith(i)),qa=/^\*+\.\*+$/,Xa=i=>!i.startsWith(".")&&i.includes("."),Za=i=>i!=="."&&i!==".."&&i.includes("."),Qa=/^\.\*+$/,tc=i=>i!=="."&&i!==".."&&i.startsWith("."),ec=/^\*+$/,sc=i=>i.length!==0&&!i.startsWith("."),ic=i=>i.length!==0&&i!=="."&&i!=="..",rc=/^\?+([^+@!?\*\[\(]*)?$/,nc=([i,t=""])=>{let e=an([i]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},oc=([i,t=""])=>{let e=cn([i]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},ac=([i,t=""])=>{let e=cn([i]);return t?s=>e(s)&&s.endsWith(t):e},cc=([i,t=""])=>{let e=an([i]);return t?s=>e(s)&&s.endsWith(t):e},an=([i])=>{let t=i.length;return e=>e.length===t&&!e.startsWith(".")},cn=([i])=>{let t=i.length;return e=>e.length===t&&e!=="."&&e!==".."},ln=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",rn={win32:{sep:"\\"},posix:{sep:"/"}},lc=ln==="win32"?rn.win32.sep:rn.posix.sep;Y.sep=lc;var G=Symbol("globstar **");Y.GLOBSTAR=G;var hc="[^/]",fc=hc+"*?",uc="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",dc="(?:(?!(?:\\/|^)\\.).)*?",pc=(i,t={})=>e=>Y(e,i,t);Y.filter=pc;var rt=(i,t={})=>Object.assign({},i,t),mc=i=>{if(!i||typeof i!="object"||!Object.keys(i).length)return Y;let t=Y;return Object.assign((s,r,n={})=>t(s,r,rt(i,n)),{Minimatch:class extends t.Minimatch{constructor(r,n={}){super(r,rt(i,n))}static defaults(r){return t.defaults(rt(i,r)).Minimatch}},AST:class extends t.AST{constructor(r,n,o={}){super(r,n,rt(i,o))}static fromGlob(r,n={}){return t.AST.fromGlob(r,rt(i,n))}},unescape:(s,r={})=>t.unescape(s,rt(i,r)),escape:(s,r={})=>t.escape(s,rt(i,r)),filter:(s,r={})=>t.filter(s,rt(i,r)),defaults:s=>t.defaults(rt(i,s)),makeRe:(s,r={})=>t.makeRe(s,rt(i,r)),braceExpand:(s,r={})=>t.braceExpand(s,rt(i,r)),match:(s,r,n={})=>t.match(s,r,rt(i,n)),sep:t.sep,GLOBSTAR:G})};Y.defaults=mc;var hn=(i,t={})=>(je(i),t.nobrace||!/\{(?:(?!\{).)*\}/.test(i)?[i]:(0,on.default)(i));Y.braceExpand=hn;var gc=(i,t={})=>new tt(i,t).makeRe();Y.makeRe=gc;var yc=(i,t,e={})=>{let s=new tt(t,e);return i=i.filter(r=>s.match(r)),s.options.nonull&&!i.length&&i.push(t),i};Y.match=yc;var nn=/[?*]|[+@!]\(.*?\)|\[|\]/,wc=i=>i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),tt=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){je(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||ln,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let t of this.set)for(let e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,this.globSet);let s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let r=this.globParts.map((n,o,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){let c=n[0]===""&&n[1]===""&&(n[2]==="?"||!nn.test(n[2]))&&!nn.test(n[3]),l=/^[a-z]:/i.test(n[0]);if(c)return[...n.slice(0,4),...n.slice(4).map(h=>this.parse(h))];if(l)return[n[0],...n.slice(1).map(h=>this.parse(h))]}return n.map(c=>this.parse(c))});if(this.debug(this.pattern,r),this.set=r.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){let o=this.set[n];o[0]===""&&o[1]===""&&this.globParts[n][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let s=0;s<t.length;s++)for(let r=0;r<t[s].length;r++)t[s][r]==="**"&&(t[s][r]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let s=-1;for(;(s=e.indexOf("**",s+1))!==-1;){let r=s;for(;e[r+1]==="**";)r++;r!==s&&e.splice(s,r-s)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((s,r)=>{let n=s[s.length-1];return r==="**"&&n==="**"?s:r===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(r),s)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let r=1;r<t.length-1;r++){let n=t[r];r===1&&n===""&&t[0]===""||(n==="."||n==="")&&(e=!0,t.splice(r,1),r--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let s=0;for(;(s=t.indexOf("..",s+1))!==-1;){let r=t[s-1];r&&r!=="."&&r!==".."&&r!=="**"&&(e=!0,t.splice(s-1,2),s-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let s of t){let r=-1;for(;(r=s.indexOf("**",r+1))!==-1;){let o=r;for(;s[o+1]==="**";)o++;o>r&&s.splice(r+1,o-r);let a=s[r+1],c=s[r+2],l=s[r+3];if(a!==".."||!c||c==="."||c===".."||!l||l==="."||l==="..")continue;e=!0,s.splice(r,1);let h=s.slice(0);h[r]="**",t.push(h),r--}if(!this.preserveMultipleSlashes){for(let o=1;o<s.length-1;o++){let a=s[o];o===1&&a===""&&s[0]===""||(a==="."||a==="")&&(e=!0,s.splice(o,1),o--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(e=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){let o=s[n-1];if(o&&o!=="."&&o!==".."&&o!=="**"){e=!0;let c=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...c),s.length===0&&s.push(""),n-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++){let r=this.partsMatch(t[e],t[s],!this.preserveMultipleSlashes);r&&(t[e]=r,t[s]=[])}return t.filter(e=>e.length)}partsMatch(t,e,s=!1){let r=0,n=0,o=[],a="";for(;r<t.length&&n<e.length;)if(t[r]===e[n])o.push(a==="b"?e[n]:t[r]),r++,n++;else if(s&&t[r]==="**"&&e[n]===t[r+1])o.push(t[r]),r++;else if(s&&e[n]==="**"&&t[r]===e[n+1])o.push(e[n]),n++;else if(t[r]==="*"&&e[n]&&(this.options.dot||!e[n].startsWith("."))&&e[n]!=="**"){if(a==="b")return!1;a="a",o.push(t[r]),r++,n++}else if(e[n]==="*"&&t[r]&&(this.options.dot||!t[r].startsWith("."))&&t[r]!=="**"){if(a==="a")return!1;a="b",o.push(e[n]),r++,n++}else return!1;return t.length===e.length&&o}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,s=0;for(let r=0;r<t.length&&t.charAt(r)==="!";r++)e=!e,s++;s&&(this.pattern=t.slice(s)),this.negate=e}matchOne(t,e,s=!1){let r=this.options;if(this.isWindows){let u=t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),p=e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]);if(u&&p){let m=t[3],w=e[3];m.toLowerCase()===w.toLowerCase()&&(t[3]=w)}else if(p&&typeof t[0]=="string"){let m=e[3],w=t[0];m.toLowerCase()===w.toLowerCase()&&(e[3]=w,e=e.slice(3))}else if(u&&typeof e[0]=="string"){let m=t[3];m.toLowerCase()===e[0].toLowerCase()&&(e[0]=m,t=t.slice(3))}}let{optimizationLevel:n=1}=this.options;n>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var o=0,a=0,c=t.length,l=e.length;o<c&&a<l;o++,a++){this.debug("matchOne loop");var h=e[a],f=t[o];if(this.debug(e,h,f),h===!1)return!1;if(h===G){this.debug("GLOBSTAR",[e,h,f]);var d=o,g=a+1;if(g===l){for(this.debug("** at the end");o<c;o++)if(t[o]==="."||t[o]===".."||!r.dot&&t[o].charAt(0)===".")return!1;return!0}for(;d<c;){var S=t[d];if(this.debug(`
globstar while`,t,d,e,g,S),this.matchOne(t.slice(d),e.slice(g),s))return this.debug("globstar found match!",d,c,S),!0;if(S==="."||S===".."||!r.dot&&S.charAt(0)==="."){this.debug("dot detected!",t,d,e,g);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(s&&(this.debug(`
>>> no match, partial?`,t,d,e,g),d===c))}let u;if(typeof h=="string"?(u=f===h,this.debug("string match",h,f,u)):(u=h.test(f),this.debug("pattern match",h,f,u)),!u)return!1}if(o===c&&a===l)return!0;if(o===c)return s;if(a===l)return o===c-1&&t[o]==="";throw new Error("wtf?")}braceExpand(){return hn(this.pattern,this.options)}parse(t){je(t);let e=this.options;if(t==="**")return G;if(t==="")return"";let s,r=null;(s=t.match(ec))?r=e.dot?ic:sc:(s=t.match(Va))?r=(e.nocase?e.dot?Ya:Ja:e.dot?Ha:Ka)(s[1]):(s=t.match(rc))?r=(e.nocase?e.dot?oc:nc:e.dot?ac:cc)(s):(s=t.match(qa))?r=e.dot?Za:Xa:(s=t.match(Qa))&&(r=tc);let n=Ft.fromGlob(t,this.options).toMMPattern();return r?Object.assign(n,{test:r}):n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,s=e.noglobstar?fc:e.dot?uc:dc,r=new Set(e.nocase?["i"]:[]),n=t.map(c=>{let l=c.map(h=>{if(h instanceof RegExp)for(let f of h.flags.split(""))r.add(f);return typeof h=="string"?wc(h):h===G?G:h._src});return l.forEach((h,f)=>{let d=l[f+1],g=l[f-1];h!==G||g===G||(g===void 0?d!==void 0&&d!==G?l[f+1]="(?:\\/|"+s+"\\/)?"+d:l[f]=s:d===void 0?l[f-1]=g+"(?:\\/|"+s+")?":d!==G&&(l[f-1]=g+"(?:\\/|\\/"+s+"\\/)"+d,l[f+1]=G))}),l.filter(h=>h!==G).join("/")}).join("|"),[o,a]=t.length>1?["(?:",")"]:["",""];n="^"+o+n+a+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;let s=this.options;this.isWindows&&(t=t.split("\\").join("/"));let r=this.slashSplit(t);this.debug(this.pattern,"split",r);let n=this.set;this.debug(this.pattern,"set",n);let o=r[r.length-1];if(!o)for(let a=r.length-2;!o&&a>=0;a--)o=r[a];for(let a=0;a<n.length;a++){let c=n[a],l=r;if(s.matchBase&&c.length===1&&(l=[o]),this.matchOne(l,c,e))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(t){return Y.defaults(t).Minimatch}};Y.AST=Ft;Y.Minimatch=tt;Y.escape=ee;Y.unescape=ct;var se=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,un=new Set,gi=typeof process=="object"&&process?process:{},dn=(i,t,e,s)=>{typeof gi.emitWarning=="function"?gi.emitWarning(i,t,e,s):console.error(`[${e}] ${t}: ${i}`)},ms=globalThis.AbortController,fn=globalThis.AbortSignal;if(typeof ms>"u"){fn=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(s,r){this._onabort.push(r)}},ms=class{constructor(){t()}signal=new fn;abort(s){if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(let r of this.signal._onabort)r(s);this.signal.onabort?.(s)}}};let i=gi.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",t=()=>{i&&(i=!1,dn("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}var xc=i=>!un.has(i),Bu=Symbol("type"),jt=i=>i&&i===Math.floor(i)&&i>0&&isFinite(i),pn=i=>jt(i)?i<=Math.pow(2,8)?Uint8Array:i<=Math.pow(2,16)?Uint16Array:i<=Math.pow(2,32)?Uint32Array:i<=Number.MAX_SAFE_INTEGER?re:null:null,re=class extends Array{constructor(t){super(t),this.fill(0)}},ne,ie=class{heap;length;static create(t){let e=pn(t);if(!e)return[];R(ie,ne,!0);let s=new ie(t,e);return R(ie,ne,!1),s}constructor(t,e){if(!y(ie,ne))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}},ps=ie;ne=new WeakMap,z(ps,ne,!1);var Ut=class{#e;#r;#i;#a;#f;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#l;#p;#c;#n;#t;#g;#x;#m;#u;#T;#d;#C;#A;#S;#w;#O;#h;static unsafeExposeInternals(t){return{starts:t.#A,ttls:t.#S,sizes:t.#C,keyMap:t.#c,keyList:t.#n,valList:t.#t,next:t.#g,prev:t.#x,get head(){return t.#m},get tail(){return t.#u},free:t.#T,isBackgroundFetch:e=>t.#o(e),backgroundFetch:(e,s,r,n)=>t.#j(e,s,r,n),moveToTail:e=>t.#F(e),indexes:e=>t.#v(e),rindexes:e=>t.#N(e),isStale:e=>t.#y(e)}}get max(){return this.#e}get maxSize(){return this.#r}get calculatedSize(){return this.#p}get size(){return this.#l}get fetchMethod(){return this.#f}get dispose(){return this.#i}get disposeAfter(){return this.#a}constructor(t){let{max:e=0,ttl:s,ttlResolution:r=1,ttlAutopurge:n,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:c,dispose:l,disposeAfter:h,noDisposeOnSet:f,noUpdateTTL:d,maxSize:g=0,maxEntrySize:S=0,sizeCalculation:u,fetchMethod:p,noDeleteOnFetchRejection:m,noDeleteOnStaleGet:w,allowStaleOnFetchRejection:x,allowStaleOnFetchAbort:E,ignoreFetchAbort:T}=t;if(e!==0&&!jt(e))throw new TypeError("max option must be a nonnegative integer");let C=e?pn(e):Array;if(!C)throw new Error("invalid max value: "+e);if(this.#e=e,this.#r=g,this.maxEntrySize=S||this.#r,this.sizeCalculation=u,this.sizeCalculation){if(!this.#r&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(p!==void 0&&typeof p!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#f=p,this.#O=!!p,this.#c=new Map,this.#n=new Array(e).fill(void 0),this.#t=new Array(e).fill(void 0),this.#g=new C(e),this.#x=new C(e),this.#m=0,this.#u=0,this.#T=ps.create(e),this.#l=0,this.#p=0,typeof l=="function"&&(this.#i=l),typeof h=="function"?(this.#a=h,this.#d=[]):(this.#a=void 0,this.#d=void 0),this.#w=!!this.#i,this.#h=!!this.#a,this.noDisposeOnSet=!!f,this.noUpdateTTL=!!d,this.noDeleteOnFetchRejection=!!m,this.allowStaleOnFetchRejection=!!x,this.allowStaleOnFetchAbort=!!E,this.ignoreFetchAbort=!!T,this.maxEntrySize!==0){if(this.#r!==0&&!jt(this.#r))throw new TypeError("maxSize must be a positive integer if specified");if(!jt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#D()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!w,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=jt(r)||r===0?r:1,this.ttlAutopurge=!!n,this.ttl=s||0,this.ttl){if(!jt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#k()}if(this.#e===0&&this.ttl===0&&this.#r===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#e&&!this.#r){let L="LRU_CACHE_UNBOUNDED";xc(L)&&(un.add(L),dn("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",L,Ut))}}getRemainingTTL(t){return this.#c.has(t)?1/0:0}#k(){let t=new re(this.#e),e=new re(this.#e);this.#S=t,this.#A=e,this.#s=(n,o,a=se.now())=>{if(e[n]=o!==0?a:0,t[n]=o,o!==0&&this.ttlAutopurge){let c=setTimeout(()=>{this.#y(n)&&this.delete(this.#n[n])},o+1);c.unref&&c.unref()}},this.#R=n=>{e[n]=t[n]!==0?se.now():0},this.#b=(n,o)=>{if(t[o]){let a=t[o],c=e[o];if(!a||!c)return;n.ttl=a,n.start=c,n.now=s||r();let l=n.now-c;n.remainingTTL=a-l}};let s=0,r=()=>{let n=se.now();if(this.ttlResolution>0){s=n;let o=setTimeout(()=>s=0,this.ttlResolution);o.unref&&o.unref()}return n};this.getRemainingTTL=n=>{let o=this.#c.get(n);if(o===void 0)return 0;let a=t[o],c=e[o];if(!a||!c)return 1/0;let l=(s||r())-c;return a-l},this.#y=n=>{let o=e[n],a=t[n];return!!a&&!!o&&(s||r())-o>a}}#R=()=>{};#b=()=>{};#s=()=>{};#y=()=>!1;#D(){let t=new re(this.#e);this.#p=0,this.#C=t,this.#E=e=>{this.#p-=t[e],t[e]=0},this.#P=(e,s,r,n)=>{if(this.#o(s))return 0;if(!jt(r))if(n){if(typeof n!="function")throw new TypeError("sizeCalculation must be a function");if(r=n(s,e),!jt(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return r},this.#L=(e,s,r)=>{if(t[e]=s,this.#r){let n=this.#r-t[e];for(;this.#p>n;)this.#I(!0)}this.#p+=t[e],r&&(r.entrySize=s,r.totalCalculatedSize=this.#p)}}#E=t=>{};#L=(t,e,s)=>{};#P=(t,e,s,r)=>{if(s||r)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#v({allowStale:t=this.allowStale}={}){if(this.#l)for(let e=this.#u;!(!this.#M(e)||((t||!this.#y(e))&&(yield e),e===this.#m));)e=this.#x[e]}*#N({allowStale:t=this.allowStale}={}){if(this.#l)for(let e=this.#m;!(!this.#M(e)||((t||!this.#y(e))&&(yield e),e===this.#u));)e=this.#g[e]}#M(t){return t!==void 0&&this.#c.get(this.#n[t])===t}*entries(){for(let t of this.#v())this.#t[t]!==void 0&&this.#n[t]!==void 0&&!this.#o(this.#t[t])&&(yield[this.#n[t],this.#t[t]])}*rentries(){for(let t of this.#N())this.#t[t]!==void 0&&this.#n[t]!==void 0&&!this.#o(this.#t[t])&&(yield[this.#n[t],this.#t[t]])}*keys(){for(let t of this.#v()){let e=this.#n[t];e!==void 0&&!this.#o(this.#t[t])&&(yield e)}}*rkeys(){for(let t of this.#N()){let e=this.#n[t];e!==void 0&&!this.#o(this.#t[t])&&(yield e)}}*values(){for(let t of this.#v())this.#t[t]!==void 0&&!this.#o(this.#t[t])&&(yield this.#t[t])}*rvalues(){for(let t of this.#N())this.#t[t]!==void 0&&!this.#o(this.#t[t])&&(yield this.#t[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(let s of this.#v()){let r=this.#t[s],n=this.#o(r)?r.__staleWhileFetching:r;if(n!==void 0&&t(n,this.#n[s],this))return this.get(this.#n[s],e)}}forEach(t,e=this){for(let s of this.#v()){let r=this.#t[s],n=this.#o(r)?r.__staleWhileFetching:r;n!==void 0&&t.call(e,n,this.#n[s],this)}}rforEach(t,e=this){for(let s of this.#N()){let r=this.#t[s],n=this.#o(r)?r.__staleWhileFetching:r;n!==void 0&&t.call(e,n,this.#n[s],this)}}purgeStale(){let t=!1;for(let e of this.#N({allowStale:!0}))this.#y(e)&&(this.delete(this.#n[e]),t=!0);return t}info(t){let e=this.#c.get(t);if(e===void 0)return;let s=this.#t[e],r=this.#o(s)?s.__staleWhileFetching:s;if(r===void 0)return;let n={value:r};if(this.#S&&this.#A){let o=this.#S[e],a=this.#A[e];if(o&&a){let c=o-(se.now()-a);n.ttl=c,n.start=Date.now()}}return this.#C&&(n.size=this.#C[e]),n}dump(){let t=[];for(let e of this.#v({allowStale:!0})){let s=this.#n[e],r=this.#t[e],n=this.#o(r)?r.__staleWhileFetching:r;if(n===void 0||s===void 0)continue;let o={value:n};if(this.#S&&this.#A){o.ttl=this.#S[e];let a=se.now()-this.#A[e];o.start=Math.floor(Date.now()-a)}this.#C&&(o.size=this.#C[e]),t.unshift([s,o])}return t}load(t){this.clear();for(let[e,s]of t){if(s.start){let r=Date.now()-s.start;s.start=se.now()-r}this.set(e,s.value,s)}}set(t,e,s={}){if(e===void 0)return this.delete(t),this;let{ttl:r=this.ttl,start:n,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:c}=s,{noUpdateTTL:l=this.noUpdateTTL}=s,h=this.#P(t,e,s.size||0,a);if(this.maxEntrySize&&h>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.delete(t),this;let f=this.#l===0?void 0:this.#c.get(t);if(f===void 0)f=this.#l===0?this.#u:this.#T.length!==0?this.#T.pop():this.#l===this.#e?this.#I(!1):this.#l,this.#n[f]=t,this.#t[f]=e,this.#c.set(t,f),this.#g[this.#u]=f,this.#x[f]=this.#u,this.#u=f,this.#l++,this.#L(f,h,c),c&&(c.set="add"),l=!1;else{this.#F(f);let d=this.#t[f];if(e!==d){if(this.#O&&this.#o(d)){d.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:g}=d;g!==void 0&&!o&&(this.#w&&this.#i?.(g,t,"set"),this.#h&&this.#d?.push([g,t,"set"]))}else o||(this.#w&&this.#i?.(d,t,"set"),this.#h&&this.#d?.push([d,t,"set"]));if(this.#E(f),this.#L(f,h,c),this.#t[f]=e,c){c.set="replace";let g=d&&this.#o(d)?d.__staleWhileFetching:d;g!==void 0&&(c.oldValue=g)}}else c&&(c.set="update")}if(r!==0&&!this.#S&&this.#k(),this.#S&&(l||this.#s(f,r,n),c&&this.#b(c,f)),!o&&this.#h&&this.#d){let d=this.#d,g;for(;g=d?.shift();)this.#a?.(...g)}return this}pop(){try{for(;this.#l;){let t=this.#t[this.#m];if(this.#I(!0),this.#o(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(this.#h&&this.#d){let t=this.#d,e;for(;e=t?.shift();)this.#a?.(...e)}}}#I(t){let e=this.#m,s=this.#n[e],r=this.#t[e];return this.#O&&this.#o(r)?r.__abortController.abort(new Error("evicted")):(this.#w||this.#h)&&(this.#w&&this.#i?.(r,s,"evict"),this.#h&&this.#d?.push([r,s,"evict"])),this.#E(e),t&&(this.#n[e]=void 0,this.#t[e]=void 0,this.#T.push(e)),this.#l===1?(this.#m=this.#u=0,this.#T.length=0):this.#m=this.#g[e],this.#c.delete(s),this.#l--,e}has(t,e={}){let{updateAgeOnHas:s=this.updateAgeOnHas,status:r}=e,n=this.#c.get(t);if(n!==void 0){let o=this.#t[n];if(this.#o(o)&&o.__staleWhileFetching===void 0)return!1;if(this.#y(n))r&&(r.has="stale",this.#b(r,n));else return s&&this.#R(n),r&&(r.has="hit",this.#b(r,n)),!0}else r&&(r.has="miss");return!1}peek(t,e={}){let{allowStale:s=this.allowStale}=e,r=this.#c.get(t);if(r===void 0||!s&&this.#y(r))return;let n=this.#t[r];return this.#o(n)?n.__staleWhileFetching:n}#j(t,e,s,r){let n=e===void 0?void 0:this.#t[e];if(this.#o(n))return n;let o=new ms,{signal:a}=s;a?.addEventListener("abort",()=>o.abort(a.reason),{signal:o.signal});let c={signal:o.signal,options:s,context:r},l=(u,p=!1)=>{let{aborted:m}=o.signal,w=s.ignoreFetchAbort&&u!==void 0;if(s.status&&(m&&!p?(s.status.fetchAborted=!0,s.status.fetchError=o.signal.reason,w&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),m&&!w&&!p)return f(o.signal.reason);let x=g;return this.#t[e]===g&&(u===void 0?x.__staleWhileFetching?this.#t[e]=x.__staleWhileFetching:this.delete(t):(s.status&&(s.status.fetchUpdated=!0),this.set(t,u,c.options))),u},h=u=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=u),f(u)),f=u=>{let{aborted:p}=o.signal,m=p&&s.allowStaleOnFetchAbort,w=m||s.allowStaleOnFetchRejection,x=w||s.noDeleteOnFetchRejection,E=g;if(this.#t[e]===g&&(!x||E.__staleWhileFetching===void 0?this.delete(t):m||(this.#t[e]=E.__staleWhileFetching)),w)return s.status&&E.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),E.__staleWhileFetching;if(E.__returned===E)throw u},d=(u,p)=>{let m=this.#f?.(t,n,c);m&&m instanceof Promise&&m.then(w=>u(w===void 0?void 0:w),p),o.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(u(void 0),s.allowStaleOnFetchAbort&&(u=w=>l(w,!0)))})};s.status&&(s.status.fetchDispatched=!0);let g=new Promise(d).then(l,h),S=Object.assign(g,{__abortController:o,__staleWhileFetching:n,__returned:void 0});return e===void 0?(this.set(t,S,{...c.options,status:void 0}),e=this.#c.get(t)):this.#t[e]=S,S}#o(t){if(!this.#O)return!1;let e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof ms}async fetch(t,e={}){let{allowStale:s=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:c=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:d=this.allowStaleOnFetchRejection,ignoreFetchAbort:g=this.ignoreFetchAbort,allowStaleOnFetchAbort:S=this.allowStaleOnFetchAbort,context:u,forceRefresh:p=!1,status:m,signal:w}=e;if(!this.#O)return m&&(m.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:r,noDeleteOnStaleGet:n,status:m});let x={allowStale:s,updateAgeOnGet:r,noDeleteOnStaleGet:n,ttl:o,noDisposeOnSet:a,size:c,sizeCalculation:l,noUpdateTTL:h,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:d,allowStaleOnFetchAbort:S,ignoreFetchAbort:g,status:m,signal:w},E=this.#c.get(t);if(E===void 0){m&&(m.fetch="miss");let T=this.#j(t,E,x,u);return T.__returned=T}else{let T=this.#t[E];if(this.#o(T)){let mt=s&&T.__staleWhileFetching!==void 0;return m&&(m.fetch="inflight",mt&&(m.returnedStale=!0)),mt?T.__staleWhileFetching:T.__returned=T}let C=this.#y(E);if(!p&&!C)return m&&(m.fetch="hit"),this.#F(E),r&&this.#R(E),m&&this.#b(m,E),T;let L=this.#j(t,E,x,u),K=L.__staleWhileFetching!==void 0&&s;return m&&(m.fetch=C?"stale":"refresh",K&&C&&(m.returnedStale=!0)),K?L.__staleWhileFetching:L.__returned=L}}get(t,e={}){let{allowStale:s=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,status:o}=e,a=this.#c.get(t);if(a!==void 0){let c=this.#t[a],l=this.#o(c);return o&&this.#b(o,a),this.#y(a)?(o&&(o.get="stale"),l?(o&&s&&c.__staleWhileFetching!==void 0&&(o.returnedStale=!0),s?c.__staleWhileFetching:void 0):(n||this.delete(t),o&&s&&(o.returnedStale=!0),s?c:void 0)):(o&&(o.get="hit"),l?c.__staleWhileFetching:(this.#F(a),r&&this.#R(a),c))}else o&&(o.get="miss")}#_(t,e){this.#x[e]=t,this.#g[t]=e}#F(t){t!==this.#u&&(t===this.#m?this.#m=this.#g[t]:this.#_(this.#x[t],this.#g[t]),this.#_(this.#u,t),this.#u=t)}delete(t){let e=!1;if(this.#l!==0){let s=this.#c.get(t);if(s!==void 0)if(e=!0,this.#l===1)this.clear();else{this.#E(s);let r=this.#t[s];if(this.#o(r)?r.__abortController.abort(new Error("deleted")):(this.#w||this.#h)&&(this.#w&&this.#i?.(r,t,"delete"),this.#h&&this.#d?.push([r,t,"delete"])),this.#c.delete(t),this.#n[s]=void 0,this.#t[s]=void 0,s===this.#u)this.#u=this.#x[s];else if(s===this.#m)this.#m=this.#g[s];else{let n=this.#x[s];this.#g[n]=this.#g[s];let o=this.#g[s];this.#x[o]=this.#x[s]}this.#l--,this.#T.push(s)}}if(this.#h&&this.#d?.length){let s=this.#d,r;for(;r=s?.shift();)this.#a?.(...r)}return e}clear(){for(let t of this.#N({allowStale:!0})){let e=this.#t[t];if(this.#o(e))e.__abortController.abort(new Error("deleted"));else{let s=this.#n[t];this.#w&&this.#i?.(e,s,"delete"),this.#h&&this.#d?.push([e,s,"delete"])}}if(this.#c.clear(),this.#t.fill(void 0),this.#n.fill(void 0),this.#S&&this.#A&&(this.#S.fill(0),this.#A.fill(0)),this.#C&&this.#C.fill(0),this.#m=0,this.#u=0,this.#T.length=0,this.#p=0,this.#l=0,this.#h&&this.#d){let t=this.#d,e;for(;e=t?.shift();)this.#a?.(...e)}}};import{posix as kc,win32 as Ai}from"path";import{fileURLToPath as Dc}from"url";import*as Ic from"fs";import{lstatSync as Fc,readdir as jc,readdirSync as Lc,readlinkSync as Pc,realpathSync as Mc}from"fs";import{lstat as $c,readdir as Wc,readlink as Bc,realpath as Uc}from"fs/promises";import{EventEmitter as vi}from"events";import xn from"stream";import{StringDecoder as Sc}from"string_decoder";var mn=typeof process=="object"&&process?process:{stdout:null,stderr:null},bc=i=>!!i&&typeof i=="object"&&(i instanceof ce||i instanceof xn||Ec(i)||vc(i)),Ec=i=>!!i&&typeof i=="object"&&i instanceof vi&&typeof i.pipe=="function"&&i.pipe!==xn.Writable.prototype.pipe,vc=i=>!!i&&typeof i=="object"&&i instanceof vi&&typeof i.write=="function"&&typeof i.end=="function",xt=Symbol("EOF"),St=Symbol("maybeEmitEnd"),Lt=Symbol("emittedEnd"),gs=Symbol("emittingEnd"),Me=Symbol("emittedError"),ys=Symbol("closed"),gn=Symbol("read"),ws=Symbol("flush"),yn=Symbol("flushChunk"),lt=Symbol("encoding"),oe=Symbol("decoder"),$=Symbol("flowing"),_e=Symbol("paused"),ae=Symbol("resume"),W=Symbol("buffer"),q=Symbol("pipes"),B=Symbol("bufferLength"),yi=Symbol("bufferPush"),xs=Symbol("bufferShift"),H=Symbol("objectMode"),D=Symbol("destroyed"),wi=Symbol("error"),xi=Symbol("emitData"),wn=Symbol("emitEnd"),Si=Symbol("emitEnd2"),ut=Symbol("async"),bi=Symbol("abort"),Ss=Symbol("aborted"),$e=Symbol("signal"),zt=Symbol("dataListeners"),et=Symbol("discarded"),We=i=>Promise.resolve().then(i),Tc=i=>i(),Cc=i=>i==="end"||i==="finish"||i==="prefinish",Ac=i=>i instanceof ArrayBuffer||!!i&&typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,Rc=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),bs=class{src;dest;opts;ondrain;constructor(t,e,s){this.src=t,this.dest=e,this.opts=s,this.ondrain=()=>t[ae](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Ei=class extends bs{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,s){super(t,e,s),this.proxyErrors=r=>e.emit("error",r),t.on("error",this.proxyErrors)}},Oc=i=>!!i.objectMode,Nc=i=>!i.objectMode&&!!i.encoding&&i.encoding!=="buffer",ce=class extends vi{[$]=!1;[_e]=!1;[q]=[];[W]=[];[H];[lt];[ut];[oe];[xt]=!1;[Lt]=!1;[gs]=!1;[ys]=!1;[Me]=null;[B]=0;[D]=!1;[$e];[Ss]=!1;[zt]=0;[et]=!1;writable=!0;readable=!0;constructor(...t){let e=t[0]||{};if(super(),e.objectMode&&typeof e.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");Oc(e)?(this[H]=!0,this[lt]=null):Nc(e)?(this[lt]=e.encoding,this[H]=!1):(this[H]=!1,this[lt]=null),this[ut]=!!e.async,this[oe]=this[lt]?new Sc(this[lt]):null,e&&e.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[W]}),e&&e.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[q]});let{signal:s}=e;s&&(this[$e]=s,s.aborted?this[bi]():s.addEventListener("abort",()=>this[bi]()))}get bufferLength(){return this[B]}get encoding(){return this[lt]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[H]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[ut]}set async(t){this[ut]=this[ut]||!!t}[bi](){this[Ss]=!0,this.emit("abort",this[$e]?.reason),this.destroy(this[$e]?.reason)}get aborted(){return this[Ss]}set aborted(t){}write(t,e,s){if(this[Ss])return!1;if(this[xt])throw new Error("write after end");if(this[D])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(s=e,e="utf8"),e||(e="utf8");let r=this[ut]?We:Tc;if(!this[H]&&!Buffer.isBuffer(t)){if(Rc(t))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if(Ac(t))t=Buffer.from(t);else if(typeof t!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[H]?(this[$]&&this[B]!==0&&this[ws](!0),this[$]?this.emit("data",t):this[yi](t),this[B]!==0&&this.emit("readable"),s&&r(s),this[$]):t.length?(typeof t=="string"&&!(e===this[lt]&&!this[oe]?.lastNeed)&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[lt]&&(t=this[oe].write(t)),this[$]&&this[B]!==0&&this[ws](!0),this[$]?this.emit("data",t):this[yi](t),this[B]!==0&&this.emit("readable"),s&&r(s),this[$]):(this[B]!==0&&this.emit("readable"),s&&r(s),this[$])}read(t){if(this[D])return null;if(this[et]=!1,this[B]===0||t===0||t&&t>this[B])return this[St](),null;this[H]&&(t=null),this[W].length>1&&!this[H]&&(this[W]=[this[lt]?this[W].join(""):Buffer.concat(this[W],this[B])]);let e=this[gn](t||null,this[W][0]);return this[St](),e}[gn](t,e){if(this[H])this[xs]();else{let s=e;t===s.length||t===null?this[xs]():typeof s=="string"?(this[W][0]=s.slice(t),e=s.slice(0,t),this[B]-=t):(this[W][0]=s.subarray(t),e=s.subarray(0,t),this[B]-=t)}return this.emit("data",e),!this[W].length&&!this[xt]&&this.emit("drain"),e}end(t,e,s){return typeof t=="function"&&(s=t,t=void 0),typeof e=="function"&&(s=e,e="utf8"),t!==void 0&&this.write(t,e),s&&this.once("end",s),this[xt]=!0,this.writable=!1,(this[$]||!this[_e])&&this[St](),this}[ae](){this[D]||(!this[zt]&&!this[q].length&&(this[et]=!0),this[_e]=!1,this[$]=!0,this.emit("resume"),this[W].length?this[ws]():this[xt]?this[St]():this.emit("drain"))}resume(){return this[ae]()}pause(){this[$]=!1,this[_e]=!0,this[et]=!1}get destroyed(){return this[D]}get flowing(){return this[$]}get paused(){return this[_e]}[yi](t){this[H]?this[B]+=1:this[B]+=t.length,this[W].push(t)}[xs](){return this[H]?this[B]-=1:this[B]-=this[W][0].length,this[W].shift()}[ws](t=!1){do;while(this[yn](this[xs]())&&this[W].length);!t&&!this[W].length&&!this[xt]&&this.emit("drain")}[yn](t){return this.emit("data",t),this[$]}pipe(t,e){if(this[D])return t;this[et]=!1;let s=this[Lt];return e=e||{},t===mn.stdout||t===mn.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,s?e.end&&t.end():(this[q].push(e.proxyErrors?new Ei(this,t,e):new bs(this,t,e)),this[ut]?We(()=>this[ae]()):this[ae]()),t}unpipe(t){let e=this[q].find(s=>s.dest===t);e&&(this[q].length===1?(this[$]&&this[zt]===0&&(this[$]=!1),this[q]=[]):this[q].splice(this[q].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){let s=super.on(t,e);if(t==="data")this[et]=!1,this[zt]++,!this[q].length&&!this[$]&&this[ae]();else if(t==="readable"&&this[B]!==0)super.emit("readable");else if(Cc(t)&&this[Lt])super.emit(t),this.removeAllListeners(t);else if(t==="error"&&this[Me]){let r=e;this[ut]?We(()=>r.call(this,this[Me])):r.call(this,this[Me])}return s}removeListener(t,e){return this.off(t,e)}off(t,e){let s=super.off(t,e);return t==="data"&&(this[zt]=this.listeners("data").length,this[zt]===0&&!this[et]&&!this[q].length&&(this[$]=!1)),s}removeAllListeners(t){let e=super.removeAllListeners(t);return(t==="data"||t===void 0)&&(this[zt]=0,!this[et]&&!this[q].length&&(this[$]=!1)),e}get emittedEnd(){return this[Lt]}[St](){!this[gs]&&!this[Lt]&&!this[D]&&this[W].length===0&&this[xt]&&(this[gs]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[ys]&&this.emit("close"),this[gs]=!1)}emit(t,...e){let s=e[0];if(t!=="error"&&t!=="close"&&t!==D&&this[D])return!1;if(t==="data")return!this[H]&&!s?!1:this[ut]?(We(()=>this[xi](s)),!0):this[xi](s);if(t==="end")return this[wn]();if(t==="close"){if(this[ys]=!0,!this[Lt]&&!this[D])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(t==="error"){this[Me]=s,super.emit(wi,s);let n=!this[$e]||this.listeners("error").length?super.emit("error",s):!1;return this[St](),n}else if(t==="resume"){let n=super.emit("resume");return this[St](),n}else if(t==="finish"||t==="prefinish"){let n=super.emit(t);return this.removeAllListeners(t),n}let r=super.emit(t,...e);return this[St](),r}[xi](t){for(let s of this[q])s.dest.write(t)===!1&&this.pause();let e=this[et]?!1:super.emit("data",t);return this[St](),e}[wn](){return this[Lt]?!1:(this[Lt]=!0,this.readable=!1,this[ut]?(We(()=>this[Si]()),!0):this[Si]())}[Si](){if(this[oe]){let e=this[oe].end();if(e){for(let s of this[q])s.dest.write(e);this[et]||super.emit("data",e)}}for(let e of this[q])e.end();let t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){let t=Object.assign([],{dataLength:0});this[H]||(t.dataLength=0);let e=this.promise();return this.on("data",s=>{t.push(s),this[H]||(t.dataLength+=s.length)}),await e,t}async concat(){if(this[H])throw new Error("cannot concat in objectMode");let t=await this.collect();return this[lt]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise((t,e)=>{this.on(D,()=>e(new Error("stream destroyed"))),this.on("error",s=>e(s)),this.on("end",()=>t())})}[Symbol.asyncIterator](){this[et]=!1;let t=!1,e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return{next:()=>{if(t)return e();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[xt])return e();let n,o,a=f=>{this.off("data",c),this.off("end",l),this.off(D,h),e(),o(f)},c=f=>{this.off("error",a),this.off("end",l),this.off(D,h),this.pause(),n({value:f,done:!!this[xt]})},l=()=>{this.off("error",a),this.off("data",c),this.off(D,h),e(),n({done:!0,value:void 0})},h=()=>a(new Error("stream destroyed"));return new Promise((f,d)=>{o=d,n=f,this.once(D,h),this.once("error",a),this.once("end",l),this.once("data",c)})},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[et]=!1;let t=!1,e=()=>(this.pause(),this.off(wi,e),this.off(D,e),this.off("end",e),t=!0,{done:!0,value:void 0}),s=()=>{if(t)return e();let r=this.read();return r===null?e():{done:!1,value:r}};return this.once("end",e),this.once(wi,e),this.once(D,e),{next:s,throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){if(this[D])return t?this.emit("error",t):this.emit(D),this;this[D]=!0,this[et]=!0,this[W].length=0,this[B]=0;let e=this;return typeof e.close=="function"&&!this[ys]&&e.close(),t?this.emit("error",t):this.emit(D),this}static get isStream(){return bc}};var _c=Mc.native,Ue={lstatSync:Fc,readdir:jc,readdirSync:Lc,readlinkSync:Pc,realpathSync:_c,promises:{lstat:$c,readdir:Wc,readlink:Bc,realpath:Uc}},Tn=i=>!i||i===Ue||i===Ic?Ue:{...Ue,...i,promises:{...Ue.promises,...i.promises||{}}},Cn=/^\\\\\?\\([a-z]:)\\?$/i,zc=i=>i.replace(/\//g,"\\").replace(Cn,"$1\\"),Gc=/[\\\/]/,ot=0,An=1,Rn=2,dt=4,On=6,Nn=8,Gt=10,kn=12,nt=15,Be=~nt,Ti=16,Sn=32,ze=64,ht=128,Es=256,Ts=512,bn=ze|ht|Ts,Vc=1023,Ci=i=>i.isFile()?Nn:i.isDirectory()?dt:i.isSymbolicLink()?Gt:i.isCharacterDevice()?Rn:i.isBlockDevice()?On:i.isSocket()?kn:i.isFIFO()?An:ot,En=new Map,Ge=i=>{let t=En.get(i);if(t)return t;let e=i.normalize("NFKD");return En.set(i,e),e},vn=new Map,vs=i=>{let t=vn.get(i);if(t)return t;let e=Ge(i.toLowerCase());return vn.set(i,e),e},Cs=class extends Ut{constructor(){super({max:256})}},Ri=class extends Ut{constructor(t=16*1024){super({maxSize:t,sizeCalculation:e=>e.length+1})}},Dn=Symbol("PathScurry setAsCwd"),J=class{name;root;roots;parent;nocase;#e;#r;get dev(){return this.#r}#i;get mode(){return this.#i}#a;get nlink(){return this.#a}#f;get uid(){return this.#f}#l;get gid(){return this.#l}#p;get rdev(){return this.#p}#c;get blksize(){return this.#c}#n;get ino(){return this.#n}#t;get size(){return this.#t}#g;get blocks(){return this.#g}#x;get atimeMs(){return this.#x}#m;get mtimeMs(){return this.#m}#u;get ctimeMs(){return this.#u}#T;get birthtimeMs(){return this.#T}#d;get atime(){return this.#d}#C;get mtime(){return this.#C}#A;get ctime(){return this.#A}#S;get birthtime(){return this.#S}#w;#O;#h;#k;#R;#b;#s;#y;#D;#E;get path(){return(this.parent||this).fullpath()}constructor(t,e=ot,s,r,n,o,a){this.name=t,this.#w=n?vs(t):Ge(t),this.#s=e&Vc,this.nocase=n,this.roots=r,this.root=s||this,this.#y=o,this.#h=a.fullpath,this.#R=a.relative,this.#b=a.relativePosix,this.parent=a.parent,this.parent?this.#e=this.parent.#e:this.#e=Tn(a.fs)}depth(){return this.#O!==void 0?this.#O:this.parent?this.#O=this.parent.depth()+1:this.#O=0}childrenCache(){return this.#y}resolve(t){if(!t)return this;let e=this.getRootString(t),r=t.substring(e.length).split(this.splitSep);return e?this.getRoot(e).#L(r):this.#L(r)}#L(t){let e=this;for(let s of t)e=e.child(s);return e}children(){let t=this.#y.get(this);if(t)return t;let e=Object.assign([],{provisional:0});return this.#y.set(this,e),this.#s&=~Ti,e}child(t,e){if(t===""||t===".")return this;if(t==="..")return this.parent||this;let s=this.children(),r=this.nocase?vs(t):Ge(t);for(let c of s)if(c.#w===r)return c;let n=this.parent?this.sep:"",o=this.#h?this.#h+n+t:void 0,a=this.newChild(t,ot,{...e,parent:this,fullpath:o});return this.canReaddir()||(a.#s|=ht),s.push(a),a}relative(){if(this.#R!==void 0)return this.#R;let t=this.name,e=this.parent;if(!e)return this.#R=this.name;let s=e.relative();return s+(!s||!e.parent?"":this.sep)+t}relativePosix(){if(this.sep==="/")return this.relative();if(this.#b!==void 0)return this.#b;let t=this.name,e=this.parent;if(!e)return this.#b=this.fullpathPosix();let s=e.relativePosix();return s+(!s||!e.parent?"":"/")+t}fullpath(){if(this.#h!==void 0)return this.#h;let t=this.name,e=this.parent;if(!e)return this.#h=this.name;let r=e.fullpath()+(e.parent?this.sep:"")+t;return this.#h=r}fullpathPosix(){if(this.#k!==void 0)return this.#k;if(this.sep==="/")return this.#k=this.fullpath();if(!this.parent){let r=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(r)?this.#k=`//?/${r}`:this.#k=r}let t=this.parent,e=t.fullpathPosix(),s=e+(!e||!t.parent?"":"/")+this.name;return this.#k=s}isUnknown(){return(this.#s&nt)===ot}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return(this.#s&nt)===Nn}isDirectory(){return(this.#s&nt)===dt}isCharacterDevice(){return(this.#s&nt)===Rn}isBlockDevice(){return(this.#s&nt)===On}isFIFO(){return(this.#s&nt)===An}isSocket(){return(this.#s&nt)===kn}isSymbolicLink(){return(this.#s&Gt)===Gt}lstatCached(){return this.#s&Sn?this:void 0}readlinkCached(){return this.#D}realpathCached(){return this.#E}readdirCached(){let t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(this.#D)return!0;if(!this.parent)return!1;let t=this.#s&nt;return!(t!==ot&&t!==Gt||this.#s&Es||this.#s&ht)}calledReaddir(){return!!(this.#s&Ti)}isENOENT(){return!!(this.#s&ht)}isNamed(t){return this.nocase?this.#w===vs(t):this.#w===Ge(t)}async readlink(){let t=this.#D;if(t)return t;if(this.canReadlink()&&this.parent)try{let e=await this.#e.promises.readlink(this.fullpath()),s=this.parent.resolve(e);if(s)return this.#D=s}catch(e){this.#_(e.code);return}}readlinkSync(){let t=this.#D;if(t)return t;if(this.canReadlink()&&this.parent)try{let e=this.#e.readlinkSync(this.fullpath()),s=this.parent.resolve(e);if(s)return this.#D=s}catch(e){this.#_(e.code);return}}#P(t){this.#s|=Ti;for(let e=t.provisional;e<t.length;e++)t[e].#v()}#v(){this.#s&ht||(this.#s=(this.#s|ht)&Be,this.#N())}#N(){let t=this.children();t.provisional=0;for(let e of t)e.#v()}#M(){this.#s|=Ts,this.#I()}#I(){if(this.#s&ze)return;let t=this.#s;(t&nt)===dt&&(t&=Be),this.#s=t|ze,this.#N()}#j(t=""){t==="ENOTDIR"||t==="EPERM"?this.#I():t==="ENOENT"?this.#v():this.children().provisional=0}#o(t=""){t==="ENOTDIR"?this.parent.#I():t==="ENOENT"&&this.#v()}#_(t=""){let e=this.#s;e|=Es,t==="ENOENT"&&(e|=ht),(t==="EINVAL"||t==="UNKNOWN")&&(e&=Be),this.#s=e,t==="ENOTDIR"&&this.parent&&this.parent.#I()}#F(t,e){return this.#G(t,e)||this.#z(t,e)}#z(t,e){let s=Ci(t),r=this.newChild(t.name,s,{parent:this}),n=r.#s&nt;return n!==dt&&n!==Gt&&n!==ot&&(r.#s|=ze),e.unshift(r),e.provisional++,r}#G(t,e){for(let s=e.provisional;s<e.length;s++){let r=e[s];if((this.nocase?vs(t.name):Ge(t.name))===r.#w)return this.#V(t,r,s,e)}}#V(t,e,s,r){let n=e.name;return e.#s=e.#s&Be|Ci(t),n!==t.name&&(e.name=t.name),s!==r.provisional&&(s===r.length-1?r.pop():r.splice(s,1),r.unshift(e)),r.provisional++,e}async lstat(){if(!(this.#s&ht))try{return this.#U(await this.#e.promises.lstat(this.fullpath())),this}catch(t){this.#o(t.code)}}lstatSync(){if(!(this.#s&ht))try{return this.#U(this.#e.lstatSync(this.fullpath())),this}catch(t){this.#o(t.code)}}#U(t){let{atime:e,atimeMs:s,birthtime:r,birthtimeMs:n,blksize:o,blocks:a,ctime:c,ctimeMs:l,dev:h,gid:f,ino:d,mode:g,mtime:S,mtimeMs:u,nlink:p,rdev:m,size:w,uid:x}=t;this.#d=e,this.#x=s,this.#S=r,this.#T=n,this.#c=o,this.#g=a,this.#A=c,this.#u=l,this.#r=h,this.#l=f,this.#n=d,this.#i=g,this.#C=S,this.#m=u,this.#a=p,this.#p=m,this.#t=w,this.#f=x;let E=Ci(t);this.#s=this.#s&Be|E|Sn,E!==ot&&E!==dt&&E!==Gt&&(this.#s|=ze)}#W=[];#B=!1;#K(t){this.#B=!1;let e=this.#W.slice();this.#W.length=0,e.forEach(s=>s(null,t))}readdirCB(t,e=!1){if(!this.canReaddir()){e?t(null,[]):queueMicrotask(()=>t(null,[]));return}let s=this.children();if(this.calledReaddir()){let n=s.slice(0,s.provisional);e?t(null,n):queueMicrotask(()=>t(null,n));return}if(this.#W.push(t),this.#B)return;this.#B=!0;let r=this.fullpath();this.#e.readdir(r,{withFileTypes:!0},(n,o)=>{if(n)this.#j(n.code),s.provisional=0;else{for(let a of o)this.#F(a,s);this.#P(s)}this.#K(s.slice(0,s.provisional))})}#$;async readdir(){if(!this.canReaddir())return[];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();if(this.#$)await this.#$;else{let s=()=>{};this.#$=new Promise(r=>s=r);try{for(let r of await this.#e.promises.readdir(e,{withFileTypes:!0}))this.#F(r,t);this.#P(t)}catch(r){this.#j(r.code),t.provisional=0}this.#$=void 0,s()}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return[];let t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);let e=this.fullpath();try{for(let s of this.#e.readdirSync(e,{withFileTypes:!0}))this.#F(s,t);this.#P(t)}catch(s){this.#j(s.code),t.provisional=0}return t.slice(0,t.provisional)}canReaddir(){if(this.#s&bn)return!1;let t=nt&this.#s;return t===ot||t===dt||t===Gt}shouldWalk(t,e){return(this.#s&dt)===dt&&!(this.#s&bn)&&!t.has(this)&&(!e||e(this))}async realpath(){if(this.#E)return this.#E;if(!((Ts|Es|ht)&this.#s))try{let t=await this.#e.promises.realpath(this.fullpath());return this.#E=this.resolve(t)}catch{this.#M()}}realpathSync(){if(this.#E)return this.#E;if(!((Ts|Es|ht)&this.#s))try{let t=this.#e.realpathSync(this.fullpath());return this.#E=this.resolve(t)}catch{this.#M()}}[Dn](t){if(t===this)return;let e=new Set([]),s=[],r=this;for(;r&&r.parent;)e.add(r),r.#R=s.join(this.sep),r.#b=s.join("/"),r=r.parent,s.push("..");for(r=t;r&&r.parent&&!e.has(r);)r.#R=void 0,r.#b=void 0,r=r.parent}},le=class extends J{sep="\\";splitSep=Gc;constructor(t,e=ot,s,r,n,o,a){super(t,e,s,r,n,o,a)}newChild(t,e=ot,s={}){return new le(t,e,this.root,this.roots,this.nocase,this.childrenCache(),s)}getRootString(t){return Ai.parse(t).root}getRoot(t){if(t=zc(t.toUpperCase()),t===this.root.name)return this.root;for(let[e,s]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=s;return this.roots[t]=new fe(t,this).root}sameRoot(t,e=this.root.name){return t=t.toUpperCase().replace(/\//g,"\\").replace(Cn,"$1\\"),t===e}},he=class extends J{splitSep="/";sep="/";constructor(t,e=ot,s,r,n,o,a){super(t,e,s,r,n,o,a)}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=ot,s={}){return new he(t,e,this.root,this.roots,this.nocase,this.childrenCache(),s)}},As=class{root;rootPath;roots;cwd;#e;#r;#i;nocase;#a;constructor(t=process.cwd(),e,s,{nocase:r,childrenCacheSize:n=16*1024,fs:o=Ue}={}){this.#a=Tn(o),(t instanceof URL||t.startsWith("file://"))&&(t=Dc(t));let a=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(a),this.#e=new Cs,this.#r=new Cs,this.#i=new Ri(n);let c=a.substring(this.rootPath.length).split(s);if(c.length===1&&!c[0]&&c.pop(),r===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=r,this.root=this.newRoot(this.#a),this.roots[this.rootPath]=this.root;let l=this.root,h=c.length-1,f=e.sep,d=this.rootPath,g=!1;for(let S of c){let u=h--;l=l.child(S,{relative:new Array(u).fill("..").join(f),relativePosix:new Array(u).fill("..").join("/"),fullpath:d+=(g?"":f)+S}),g=!0}this.cwd=l}depth(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return this.#i}resolve(...t){let e="";for(let n=t.length-1;n>=0;n--){let o=t[n];if(!(!o||o===".")&&(e=e?`${o}/${e}`:o,this.isAbsolute(o)))break}let s=this.#e.get(e);if(s!==void 0)return s;let r=this.cwd.resolve(e).fullpath();return this.#e.set(e,r),r}resolvePosix(...t){let e="";for(let n=t.length-1;n>=0;n--){let o=t[n];if(!(!o||o===".")&&(e=e?`${o}/${e}`:o,this.isAbsolute(o)))break}let s=this.#r.get(e);if(s!==void 0)return s;let r=this.cwd.resolve(e).fullpathPosix();return this.#r.set(e,r),r}relative(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t,t=this.cwd);let{withFileTypes:s}=e;if(t.canReaddir()){let r=await t.readdir();return s?r:r.map(n=>n.name)}else return[]}readdirSync(t=this.cwd,e={withFileTypes:!0}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t,t=this.cwd);let{withFileTypes:s=!0}=e;return t.canReaddir()?s?t.readdirSync():t.readdirSync().map(r=>r.name):[]}async lstat(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return typeof t=="string"&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t.withFileTypes,t=this.cwd);let s=await t.readlink();return e?s:s?.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t.withFileTypes,t=this.cwd);let s=t.readlinkSync();return e?s:s?.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t.withFileTypes,t=this.cwd);let s=await t.realpath();return e?s:s?.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t.withFileTypes,t=this.cwd);let s=t.realpathSync();return e?s:s?.fullpath()}async walk(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=[];(!n||n(t))&&a.push(s?t:t.fullpath());let c=new Set,l=(f,d)=>{c.add(f),f.readdirCB((g,S)=>{if(g)return d(g);let u=S.length;if(!u)return d();let p=()=>{--u===0&&d()};for(let m of S)(!n||n(m))&&a.push(s?m:m.fullpath()),r&&m.isSymbolicLink()?m.realpath().then(w=>w?.isUnknown()?w.lstat():w).then(w=>w?.shouldWalk(c,o)?l(w,p):p()):m.shouldWalk(c,o)?l(m,p):p()},!0)},h=t;return new Promise((f,d)=>{l(h,g=>{if(g)return d(g);f(a)})})}walkSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=[];(!n||n(t))&&a.push(s?t:t.fullpath());let c=new Set([t]);for(let l of c){let h=l.readdirSync();for(let f of h){(!n||n(f))&&a.push(s?f:f.fullpath());let d=f;if(f.isSymbolicLink()){if(!(r&&(d=f.realpathSync())))continue;d.isUnknown()&&d.lstatSync()}d.shouldWalk(c,o)&&c.add(d)}}return a}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:r=!1,filter:n,walkFilter:o}=e;(!n||n(t))&&(yield s?t:t.fullpath());let a=new Set([t]);for(let c of a){let l=c.readdirSync();for(let h of l){(!n||n(h))&&(yield s?h:h.fullpath());let f=h;if(h.isSymbolicLink()){if(!(r&&(f=h.realpathSync())))continue;f.isUnknown()&&f.lstatSync()}f.shouldWalk(a,o)&&a.add(f)}}}stream(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=new ce({objectMode:!0});(!n||n(t))&&a.write(s?t:t.fullpath());let c=new Set,l=[t],h=0,f=()=>{let d=!1;for(;!d;){let g=l.shift();if(!g){h===0&&a.end();return}h++,c.add(g);let S=(p,m,w=!1)=>{if(p)return a.emit("error",p);if(r&&!w){let x=[];for(let E of m)E.isSymbolicLink()&&x.push(E.realpath().then(T=>T?.isUnknown()?T.lstat():T));if(x.length){Promise.all(x).then(()=>S(null,m,!0));return}}for(let x of m)x&&(!n||n(x))&&(a.write(s?x:x.fullpath())||(d=!0));h--;for(let x of m){let E=x.realpathCached()||x;E.shouldWalk(c,o)&&l.push(E)}d&&!a.flowing?a.once("drain",f):u||f()},u=!0;g.readdirCB(S,!0),u=!1}};return f(),a}streamSync(t=this.cwd,e={}){typeof t=="string"?t=this.cwd.resolve(t):t instanceof J||(e=t,t=this.cwd);let{withFileTypes:s=!0,follow:r=!1,filter:n,walkFilter:o}=e,a=new ce({objectMode:!0}),c=new Set;(!n||n(t))&&a.write(s?t:t.fullpath());let l=[t],h=0,f=()=>{let d=!1;for(;!d;){let g=l.shift();if(!g){h===0&&a.end();return}h++,c.add(g);let S=g.readdirSync();for(let u of S)(!n||n(u))&&(a.write(s?u:u.fullpath())||(d=!0));h--;for(let u of S){let p=u;if(u.isSymbolicLink()){if(!(r&&(p=u.realpathSync())))continue;p.isUnknown()&&p.lstatSync()}p.shouldWalk(c,o)&&l.push(p)}}d&&!a.flowing&&a.once("drain",f)};return f(),a}chdir(t=this.cwd){let e=this.cwd;this.cwd=typeof t=="string"?this.cwd.resolve(t):t,this.cwd[Dn](e)}},fe=class extends As{sep="\\";constructor(t=process.cwd(),e={}){let{nocase:s=!0}=e;super(t,Ai,"\\",{...e,nocase:s}),this.nocase=s;for(let r=this.cwd;r;r=r.parent)r.nocase=this.nocase}parseRootPath(t){return Ai.parse(t).root.toUpperCase()}newRoot(t){return new le(this.rootPath,dt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}},ue=class extends As{sep="/";constructor(t=process.cwd(),e={}){let{nocase:s=!1}=e;super(t,kc,"/",{...e,nocase:s}),this.nocase=s}parseRootPath(t){return"/"}newRoot(t){return new he(this.rootPath,dt,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}},Ve=class extends ue{constructor(t=process.cwd(),e={}){let{nocase:s=!0}=e;super(t,{...e,nocase:s})}},td=process.platform==="win32"?le:he,In=process.platform==="win32"?fe:process.platform==="darwin"?Ve:ue;import{fileURLToPath as el}from"url";var Kc=i=>i.length>=1,Hc=i=>i.length>=1,Pt=class{#e;#r;#i;length;#a;#f;#l;#p;#c;#n;#t=!0;constructor(t,e,s,r){if(!Kc(t))throw new TypeError("empty pattern list");if(!Hc(e))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,s<0||s>=this.length)throw new TypeError("index out of range");if(this.#e=t,this.#r=e,this.#i=s,this.#a=r,this.#i===0){if(this.isUNC()){let[n,o,a,c,...l]=this.#e,[h,f,d,g,...S]=this.#r;l[0]===""&&(l.shift(),S.shift());let u=[n,o,a,c,""].join("/"),p=[h,f,d,g,""].join("/");this.#e=[u,...l],this.#r=[p,...S],this.length=this.#e.length}else if(this.isDrive()||this.isAbsolute()){let[n,...o]=this.#e,[a,...c]=this.#r;o[0]===""&&(o.shift(),c.shift());let l=n+"/",h=a+"/";this.#e=[l,...o],this.#r=[h,...c],this.length=this.#e.length}}}pattern(){return this.#e[this.#i]}isString(){return typeof this.#e[this.#i]=="string"}isGlobstar(){return this.#e[this.#i]===G}isRegExp(){return this.#e[this.#i]instanceof RegExp}globString(){return this.#l=this.#l||(this.#i===0?this.isAbsolute()?this.#r[0]+this.#r.slice(1).join("/"):this.#r.join("/"):this.#r.slice(this.#i).join("/"))}hasMore(){return this.length>this.#i+1}rest(){return this.#f!==void 0?this.#f:this.hasMore()?(this.#f=new Pt(this.#e,this.#r,this.#i+1,this.#a),this.#f.#n=this.#n,this.#f.#c=this.#c,this.#f.#p=this.#p,this.#f):this.#f=null}isUNC(){let t=this.#e;return this.#c!==void 0?this.#c:this.#c=this.#a==="win32"&&this.#i===0&&t[0]===""&&t[1]===""&&typeof t[2]=="string"&&!!t[2]&&typeof t[3]=="string"&&!!t[3]}isDrive(){let t=this.#e;return this.#p!==void 0?this.#p:this.#p=this.#a==="win32"&&this.#i===0&&this.length>1&&typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0])}isAbsolute(){let t=this.#e;return this.#n!==void 0?this.#n:this.#n=t[0]===""&&t.length>1||this.isDrive()||this.isUNC()}root(){let t=this.#e[0];return typeof t=="string"&&this.isAbsolute()&&this.#i===0?t:""}checkFollowGlobstar(){return!(this.#i===0||!this.isGlobstar()||!this.#t)}markFollowGlobstar(){return this.#i===0||!this.isGlobstar()||!this.#t?!1:(this.#t=!1,!0)}};import Jc from"events";import jn from"stream";import Yc from"string_decoder";var Fn=typeof process=="object"&&process?process:{stdout:null,stderr:null},Ln=Yc.StringDecoder,bt=Symbol("EOF"),Et=Symbol("maybeEmitEnd"),Mt=Symbol("emittedEnd"),Rs=Symbol("emittingEnd"),Ke=Symbol("emittedError"),Os=Symbol("closed"),Pn=Symbol("read"),Ns=Symbol("flush"),Mn=Symbol("flushChunk"),Z=Symbol("encoding"),vt=Symbol("decoder"),ks=Symbol("flowing"),He=Symbol("paused"),de=Symbol("resume"),I=Symbol("buffer"),pt=Symbol("pipes"),U=Symbol("bufferLength"),Oi=Symbol("bufferPush"),Ni=Symbol("bufferShift"),V=Symbol("objectMode"),F=Symbol("destroyed"),ki=Symbol("error"),Di=Symbol("emitData"),_n=Symbol("emitEnd"),Ii=Symbol("emitEnd2"),Tt=Symbol("async"),Fi=Symbol("abort"),Ds=Symbol("aborted"),Vt=Symbol("signal"),Je=i=>Promise.resolve().then(i),Bn=global._MP_NO_ITERATOR_SYMBOLS_!=="1",$n=Bn&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),Wn=Bn&&Symbol.iterator||Symbol("iterator not implemented"),qc=i=>i==="end"||i==="finish"||i==="prefinish",Xc=i=>i instanceof ArrayBuffer||typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,Zc=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),Is=class{constructor(t,e,s){this.src=t,this.dest=e,this.opts=s,this.ondrain=()=>t[de](),e.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},ji=class extends Is{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,s){super(t,e,s),this.proxyErrors=r=>e.emit("error",r),t.on("error",this.proxyErrors)}},Ye=class extends jn{constructor(t){super(),this[ks]=!1,this[He]=!1,this[pt]=[],this[I]=[],this[V]=t&&t.objectMode||!1,this[V]?this[Z]=null:this[Z]=t&&t.encoding||null,this[Z]==="buffer"&&(this[Z]=null),this[Tt]=t&&!!t.async||!1,this[vt]=this[Z]?new Ln(this[Z]):null,this[bt]=!1,this[Mt]=!1,this[Rs]=!1,this[Os]=!1,this[Ke]=null,this.writable=!0,this.readable=!0,this[U]=0,this[F]=!1,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[I]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[pt]}),this[Vt]=t&&t.signal,this[Ds]=!1,this[Vt]&&(this[Vt].addEventListener("abort",()=>this[Fi]()),this[Vt].aborted&&this[Fi]())}get bufferLength(){return this[U]}get encoding(){return this[Z]}set encoding(t){if(this[V])throw new Error("cannot set encoding in objectMode");if(this[Z]&&t!==this[Z]&&(this[vt]&&this[vt].lastNeed||this[U]))throw new Error("cannot change encoding");this[Z]!==t&&(this[vt]=t?new Ln(t):null,this[I].length&&(this[I]=this[I].map(e=>this[vt].write(e)))),this[Z]=t}setEncoding(t){this.encoding=t}get objectMode(){return this[V]}set objectMode(t){this[V]=this[V]||!!t}get async(){return this[Tt]}set async(t){this[Tt]=this[Tt]||!!t}[Fi](){this[Ds]=!0,this.emit("abort",this[Vt].reason),this.destroy(this[Vt].reason)}get aborted(){return this[Ds]}set aborted(t){}write(t,e,s){if(this[Ds])return!1;if(this[bt])throw new Error("write after end");if(this[F])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(s=e,e="utf8"),e||(e="utf8");let r=this[Tt]?Je:n=>n();return!this[V]&&!Buffer.isBuffer(t)&&(Zc(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):Xc(t)?t=Buffer.from(t):typeof t!="string"&&(this.objectMode=!0)),this[V]?(this.flowing&&this[U]!==0&&this[Ns](!0),this.flowing?this.emit("data",t):this[Oi](t),this[U]!==0&&this.emit("readable"),s&&r(s),this.flowing):t.length?(typeof t=="string"&&!(e===this[Z]&&!this[vt].lastNeed)&&(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[Z]&&(t=this[vt].write(t)),this.flowing&&this[U]!==0&&this[Ns](!0),this.flowing?this.emit("data",t):this[Oi](t),this[U]!==0&&this.emit("readable"),s&&r(s),this.flowing):(this[U]!==0&&this.emit("readable"),s&&r(s),this.flowing)}read(t){if(this[F])return null;if(this[U]===0||t===0||t>this[U])return this[Et](),null;this[V]&&(t=null),this[I].length>1&&!this[V]&&(this.encoding?this[I]=[this[I].join("")]:this[I]=[Buffer.concat(this[I],this[U])]);let e=this[Pn](t||null,this[I][0]);return this[Et](),e}[Pn](t,e){return t===e.length||t===null?this[Ni]():(this[I][0]=e.slice(t),e=e.slice(0,t),this[U]-=t),this.emit("data",e),!this[I].length&&!this[bt]&&this.emit("drain"),e}end(t,e,s){return typeof t=="function"&&(s=t,t=null),typeof e=="function"&&(s=e,e="utf8"),t&&this.write(t,e),s&&this.once("end",s),this[bt]=!0,this.writable=!1,(this.flowing||!this[He])&&this[Et](),this}[de](){this[F]||(this[He]=!1,this[ks]=!0,this.emit("resume"),this[I].length?this[Ns]():this[bt]?this[Et]():this.emit("drain"))}resume(){return this[de]()}pause(){this[ks]=!1,this[He]=!0}get destroyed(){return this[F]}get flowing(){return this[ks]}get paused(){return this[He]}[Oi](t){this[V]?this[U]+=1:this[U]+=t.length,this[I].push(t)}[Ni](){return this[V]?this[U]-=1:this[U]-=this[I][0].length,this[I].shift()}[Ns](t){do;while(this[Mn](this[Ni]())&&this[I].length);!t&&!this[I].length&&!this[bt]&&this.emit("drain")}[Mn](t){return this.emit("data",t),this.flowing}pipe(t,e){if(this[F])return;let s=this[Mt];return e=e||{},t===Fn.stdout||t===Fn.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,s?e.end&&t.end():(this[pt].push(e.proxyErrors?new ji(this,t,e):new Is(this,t,e)),this[Tt]?Je(()=>this[de]()):this[de]()),t}unpipe(t){let e=this[pt].find(s=>s.dest===t);e&&(this[pt].splice(this[pt].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){let s=super.on(t,e);return t==="data"&&!this[pt].length&&!this.flowing?this[de]():t==="readable"&&this[U]!==0?super.emit("readable"):qc(t)&&this[Mt]?(super.emit(t),this.removeAllListeners(t)):t==="error"&&this[Ke]&&(this[Tt]?Je(()=>e.call(this,this[Ke])):e.call(this,this[Ke])),s}get emittedEnd(){return this[Mt]}[Et](){!this[Rs]&&!this[Mt]&&!this[F]&&this[I].length===0&&this[bt]&&(this[Rs]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Os]&&this.emit("close"),this[Rs]=!1)}emit(t,e,...s){if(t!=="error"&&t!=="close"&&t!==F&&this[F])return;if(t==="data")return!this[V]&&!e?!1:this[Tt]?Je(()=>this[Di](e)):this[Di](e);if(t==="end")return this[_n]();if(t==="close"){if(this[Os]=!0,!this[Mt]&&!this[F])return;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(t==="error"){this[Ke]=e,super.emit(ki,e);let n=!this[Vt]||this.listeners("error").length?super.emit("error",e):!1;return this[Et](),n}else if(t==="resume"){let n=super.emit("resume");return this[Et](),n}else if(t==="finish"||t==="prefinish"){let n=super.emit(t);return this.removeAllListeners(t),n}let r=super.emit(t,e,...s);return this[Et](),r}[Di](t){for(let s of this[pt])s.dest.write(t)===!1&&this.pause();let e=super.emit("data",t);return this[Et](),e}[_n](){this[Mt]||(this[Mt]=!0,this.readable=!1,this[Tt]?Je(()=>this[Ii]()):this[Ii]())}[Ii](){if(this[vt]){let e=this[vt].end();if(e){for(let s of this[pt])s.dest.write(e);super.emit("data",e)}}for(let e of this[pt])e.end();let t=super.emit("end");return this.removeAllListeners("end"),t}collect(){let t=[];this[V]||(t.dataLength=0);let e=this.promise();return this.on("data",s=>{t.push(s),this[V]||(t.dataLength+=s.length)}),e.then(()=>t)}concat(){return this[V]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(t=>this[V]?Promise.reject(new Error("cannot concat in objectMode")):this[Z]?t.join(""):Buffer.concat(t,t.dataLength))}promise(){return new Promise((t,e)=>{this.on(F,()=>e(new Error("stream destroyed"))),this.on("error",s=>e(s)),this.on("end",()=>t())})}[$n](){let t=!1,e=()=>(this.pause(),t=!0,Promise.resolve({done:!0}));return{next:()=>{if(t)return e();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[bt])return e();let n=null,o=null,a=f=>{this.removeListener("data",c),this.removeListener("end",l),this.removeListener(F,h),e(),o(f)},c=f=>{this.removeListener("error",a),this.removeListener("end",l),this.removeListener(F,h),this.pause(),n({value:f,done:!!this[bt]})},l=()=>{this.removeListener("error",a),this.removeListener("data",c),this.removeListener(F,h),e(),n({done:!0})},h=()=>a(new Error("stream destroyed"));return new Promise((f,d)=>{o=d,n=f,this.once(F,h),this.once("error",a),this.once("end",l),this.once("data",c)})},throw:e,return:e,[$n](){return this}}}[Wn](){let t=!1,e=()=>(this.pause(),this.removeListener(ki,e),this.removeListener(F,e),this.removeListener("end",e),t=!0,{done:!0}),s=()=>{if(t)return e();let r=this.read();return r===null?e():{value:r}};return this.once("end",e),this.once(ki,e),this.once(F,e),{next:s,throw:e,return:e,[Wn](){return this}}}destroy(t){return this[F]?(t?this.emit("error",t):this.emit(F),this):(this[F]=!0,this[I].length=0,this[U]=0,typeof this.close=="function"&&!this[Os]&&this.close(),t?this.emit("error",t):this.emit(F),this)}static isStream(t){return!!t&&(t instanceof Ye||t instanceof jn||t instanceof Jc&&(typeof t.pipe=="function"||typeof t.write=="function"&&typeof t.end=="function"))}},Un=Ye;var Qc=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",qe=class{relative;relativeChildren;absolute;absoluteChildren;constructor(t,{nobrace:e,nocase:s,noext:r,noglobstar:n,platform:o=Qc}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[];let a={dot:!0,nobrace:e,nocase:s,noext:r,noglobstar:n,optimizationLevel:2,platform:o,nocomment:!0,nonegate:!0};for(let c of t){let l=new tt(c,a);for(let h=0;h<l.set.length;h++){let f=l.set[h],d=l.globParts[h],g=new Pt(f,d,0,o),S=new tt(g.globString(),a),u=d[d.length-1]==="**",p=g.isAbsolute();p?this.absolute.push(S):this.relative.push(S),u&&(p?this.absoluteChildren.push(S):this.relativeChildren.push(S))}}}ignored(t){let e=t.fullpath(),s=`${e}/`,r=t.relative()||".",n=`${r}/`;for(let o of this.relative)if(o.match(r)||o.match(n))return!0;for(let o of this.absolute)if(o.match(e)||o.match(s))return!0;return!1}childrenIgnored(t){let e=t.fullpath()+"/",s=(t.relative()||".")+"/";for(let r of this.relativeChildren)if(r.match(s))return!0;for(let r of this.absoluteChildren)r.match(e);return!1}};var Xe=class{store;constructor(t=new Map){this.store=t}copy(){return new Xe(new Map(this.store))}hasWalked(t,e){return this.store.get(t.fullpath())?.has(e.globString())}storeWalked(t,e){let s=t.fullpath(),r=this.store.get(s);r?r.add(e.globString()):this.store.set(s,new Set([e.globString()]))}},Li=class{store=new Map;add(t,e,s){let r=(e?2:0)|(s?1:0),n=this.store.get(t);this.store.set(t,n===void 0?r:r&n)}entries(){return[...this.store.entries()].map(([t,e])=>[t,!!(e&2),!!(e&1)])}},Pi=class{store=new Map;add(t,e){if(!t.canReaddir())return;let s=this.store.get(t);s?s.find(r=>r.globString()===e.globString())||s.push(e):this.store.set(t,[e])}get(t){let e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map(t=>[t,this.store.get(t)])}keys(){return[...this.store.keys()].filter(t=>t.canReaddir())}},Kt=class{hasWalkedCache;matches=new Li;subwalks=new Pi;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new Xe}processPatterns(t,e){this.patterns=e;let s=e.map(r=>[t,r]);for(let[r,n]of s){this.hasWalkedCache.storeWalked(r,n);let o=n.root(),a=n.isAbsolute()&&this.opts.absolute!==!1;if(o){r=r.resolve(o==="/"&&this.opts.root!==void 0?this.opts.root:o);let f=n.rest();if(f)n=f;else{this.matches.add(r,!0,!1);continue}}if(r.isENOENT())continue;let c,l,h=!1;for(;typeof(c=n.pattern())=="string"&&(l=n.rest());){let f=r.resolve(c);if(f.isUnknown()&&c!=="..")break;r=f,n=l,h=!0}if(c=n.pattern(),l=n.rest(),h){if(this.hasWalkedCache.hasWalked(r,n))continue;this.hasWalkedCache.storeWalked(r,n)}if(typeof c=="string"){if(l)this.subwalks.add(r,n);else{let f=c===".."||c===""||c===".";this.matches.add(r.resolve(c),a,f)}continue}else if(c===G){(!r.isSymbolicLink()||this.follow||n.checkFollowGlobstar())&&this.subwalks.add(r,n);let f=l?.pattern(),d=l?.rest();if(!l||(f===""||f===".")&&!d)this.matches.add(r,a,f===""||f===".");else if(f===".."){let g=r.parent||r;d?this.hasWalkedCache.hasWalked(g,d)||this.subwalks.add(g,d):this.matches.add(g,a,!0)}}else c instanceof RegExp&&this.subwalks.add(r,n)}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new Kt(this.opts,this.hasWalkedCache)}filterEntries(t,e){let s=this.subwalks.get(t),r=this.child();for(let n of e)for(let o of s){let a=o.isAbsolute(),c=o.pattern(),l=o.rest();c===G?r.testGlobstar(n,o,l,a):c instanceof RegExp?r.testRegExp(n,c,l,a):r.testString(n,c,l,a)}return r}testGlobstar(t,e,s,r){if((this.dot||!t.name.startsWith("."))&&(e.hasMore()||this.matches.add(t,r,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(s&&e.checkFollowGlobstar()?this.subwalks.add(t,s):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),s){let n=s.pattern();if(typeof n=="string"&&n!==".."&&n!==""&&n!==".")this.testString(t,n,s.rest(),r);else if(n===".."){let o=t.parent||t;this.subwalks.add(o,s)}else n instanceof RegExp&&this.testRegExp(t,n,s.rest(),r)}}testRegExp(t,e,s,r){e.test(t.name)&&(s?this.subwalks.add(t,s):this.matches.add(t,r,!1))}testString(t,e,s,r){t.isNamed(e)&&(s?this.subwalks.add(t,s):this.matches.add(t,r,!1))}};var tl=(i,t)=>typeof i=="string"?new qe([i],t):Array.isArray(i)?new qe(i,t):i,Fs=class{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#e=[];#r;#i;signal;maxDepth;constructor(t,e,s){this.patterns=t,this.path=e,this.opts=s,this.#i=s.platform==="win32"?"\\":"/",s.ignore&&(this.#r=tl(s.ignore,s)),this.maxDepth=s.maxDepth||1/0,s.signal&&(this.signal=s.signal,this.signal.addEventListener("abort",()=>{this.#e.length=0}))}#a(t){return this.seen.has(t)||!!this.#r?.ignored?.(t)}#f(t){return!!this.#r?.childrenIgnored?.(t)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;this.paused=!1;let t;for(;!this.paused&&(t=this.#e.shift());)t()}onResume(t){this.signal?.aborted||(this.paused?this.#e.push(t):t())}async matchCheck(t,e){if(e&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=t.realpathCached()||await t.realpath(),!s)return;t=s}let r=t.isUnknown()||this.opts.stat;return this.matchCheckTest(r?await t.lstat():t,e)}matchCheckTest(t,e){return t&&(this.maxDepth===1/0||t.depth()<=this.maxDepth)&&(!e||t.canReaddir())&&(!this.opts.nodir||!t.isDirectory())&&!this.#a(t)?t:void 0}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=t.realpathCached()||t.realpathSync(),!s)return;t=s}let r=t.isUnknown()||this.opts.stat;return this.matchCheckTest(r?t.lstatSync():t,e)}matchFinish(t,e){if(this.#a(t))return;let s=this.opts.absolute===void 0?e:this.opts.absolute;this.seen.add(t);let r=this.opts.mark&&t.isDirectory()?this.#i:"";if(this.opts.withFileTypes)this.matchEmit(t);else if(s)this.matchEmit(t.fullpath()+r);else{let n=t.relative(),o=this.opts.dotRelative&&!n.startsWith(".."+this.#i)?"."+this.#i:"";this.matchEmit(!n&&r?"."+r:o+n+r)}}async match(t,e,s){let r=await this.matchCheck(t,s);r&&this.matchFinish(r,e)}matchSync(t,e,s){let r=this.matchCheckSync(t,s);r&&this.matchFinish(r,e)}walkCB(t,e,s){this.signal?.aborted&&s(),this.walkCB2(t,e,new Kt(this.opts),s)}walkCB2(t,e,s,r){if(this.#f(t))return r();if(this.signal?.aborted&&r(),this.paused){this.onResume(()=>this.walkCB2(t,e,s,r));return}s.processPatterns(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,c,l]of s.matches.entries())this.#a(a)||(n++,this.match(a,c,l).then(()=>o()));for(let a of s.subwalkTargets()){if(this.maxDepth!==1/0&&a.depth()>=this.maxDepth)continue;n++;let c=a.readdirCached();a.calledReaddir()?this.walkCB3(a,c,s,o):a.readdirCB((l,h)=>this.walkCB3(a,h,s,o),!0)}o()}walkCB3(t,e,s,r){s=s.filterEntries(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,c,l]of s.matches.entries())this.#a(a)||(n++,this.match(a,c,l).then(()=>o()));for(let[a,c]of s.subwalks.entries())n++,this.walkCB2(a,c,s.child(),o);o()}walkCBSync(t,e,s){this.signal?.aborted&&s(),this.walkCB2Sync(t,e,new Kt(this.opts),s)}walkCB2Sync(t,e,s,r){if(this.#f(t))return r();if(this.signal?.aborted&&r(),this.paused){this.onResume(()=>this.walkCB2Sync(t,e,s,r));return}s.processPatterns(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,c,l]of s.matches.entries())this.#a(a)||this.matchSync(a,c,l);for(let a of s.subwalkTargets()){if(this.maxDepth!==1/0&&a.depth()>=this.maxDepth)continue;n++;let c=a.readdirSync();this.walkCB3Sync(a,c,s,o)}o()}walkCB3Sync(t,e,s,r){s=s.filterEntries(t,e);let n=1,o=()=>{--n===0&&r()};for(let[a,c,l]of s.matches.entries())this.#a(a)||this.matchSync(a,c,l);for(let[a,c]of s.subwalks.entries())n++,this.walkCB2Sync(a,c,s.child(),o);o()}},Ze=class extends Fs{matches;constructor(t,e,s){super(t,e,s),this.matches=new Set}matchEmit(t){this.matches.add(t)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((t,e)=>{this.walkCB(this.path,this.patterns,()=>{this.signal?.aborted?e(this.signal.reason):t(this.matches)})}),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{if(this.signal?.aborted)throw this.signal.reason}),this.matches}},Qe=class extends Fs{results;constructor(t,e,s){super(t,e,s),this.results=new Un({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume())}matchEmit(t){this.results.write(t),this.results.flowing||this.pause()}stream(){let t=this.path;return t.isUnknown()?t.lstat().then(()=>{this.walkCB(t,this.patterns,()=>this.results.end())}):this.walkCB(t,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}};var sl=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",ft=class{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;opts;patterns;constructor(t,e){if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=el(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof t=="string"&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(t=t.map(a=>a.replace(/\\/g,"/"))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map(a=>a.includes("/")?a:`./**/${a}`)}if(this.pattern=t,this.platform=e.platform||sl,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,e.nocase!==void 0&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{let a=e.platform==="win32"?fe:e.platform==="darwin"?Ve:e.platform?ue:In;this.scurry=new a(this.cwd,{nocase:e.nocase,fs:e.fs})}this.nocase=this.scurry.nocase;let s={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:!0,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},r=this.pattern.map(a=>new tt(a,s)),[n,o]=r.reduce((a,c)=>(a[0].push(...c.set),a[1].push(...c.globParts),a),[[],[]]);this.patterns=n.map((a,c)=>new Pt(a,o[c],0,this.platform))}async walk(){return[...await new Ze(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walk()]}walkSync(){return[...new Ze(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walkSync()]}stream(){return new Qe(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).stream()}streamSync(){return new Qe(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}};var Mi=(i,t={})=>{Array.isArray(i)||(i=[i]);for(let e of i)if(new tt(e,t).hasMagic())return!0;return!1};function Ls(i,t={}){return new ft(i,t).streamSync()}function zn(i,t={}){return new ft(i,t).stream()}function Ps(i,t={}){return new ft(i,t).walkSync()}async function js(i,t={}){return new ft(i,t).walk()}function Ms(i,t={}){return new ft(i,t).iterateSync()}function Gn(i,t={}){return new ft(i,t).iterate()}var il=Ls,rl=Object.assign(zn,{sync:Ls}),nl=Ms,ol=Object.assign(Gn,{sync:Ms}),al=Object.assign(Ps,{stream:Ls,iterate:Ms}),Od=Object.assign(js,{glob:js,globSync:Ps,sync:al,globStream:zn,stream:rl,globStreamSync:Ls,streamSync:il,globIterate:Gn,iterate:ol,globIterateSync:Ms,iterateSync:nl,Glob:ft,hasMagic:Mi,escape:ee,unescape:ct});import Ct from"fs";import{chmodSync as _s,mkdirSync as Md,renameSync as Kn,rmdirSync as pe,rmSync as Hn,statSync as Jn,lstatSync as me,unlinkSync as ge}from"fs";import{readdirSync as cl}from"fs";var Vn=i=>cl(i,{withFileTypes:!0}),ll=(i,t)=>new Promise((e,s)=>Ct.chmod(i,t,(r,...n)=>r?s(r):e(...n))),hl=(i,t)=>new Promise((e,s)=>Ct.mkdir(i,t,(r,n)=>r?s(r):e(n))),fl=i=>new Promise((t,e)=>Ct.readdir(i,{withFileTypes:!0},(s,r)=>s?e(s):t(r))),ul=(i,t)=>new Promise((e,s)=>Ct.rename(i,t,(r,...n)=>r?s(r):e(...n))),dl=(i,t)=>new Promise((e,s)=>Ct.rm(i,t,(r,...n)=>r?s(r):e(...n))),pl=i=>new Promise((t,e)=>Ct.rmdir(i,(s,...r)=>s?e(s):t(...r))),ml=i=>new Promise((t,e)=>Ct.stat(i,(s,r)=>s?e(s):t(r))),gl=i=>new Promise((t,e)=>Ct.lstat(i,(s,r)=>s?e(s):t(r))),yl=i=>new Promise((t,e)=>Ct.unlink(i,(s,...r)=>s?e(s):t(...r))),Q={chmod:ll,mkdir:hl,readdir:fl,rename:ul,rm:dl,rmdir:pl,stat:ml,lstat:gl,unlink:yl};import{parse as Yn,resolve as qn}from"path";var{readdir:wl}=Q,ye=i=>wl(i).catch(t=>t),we=i=>{try{return Vn(i)}catch(t){return t}};var At=async i=>i.catch(t=>{if(t.code!=="ENOENT")throw t}),Rt=i=>{try{return i()}catch(t){if(t?.code!=="ENOENT")throw t}};var{lstat:xl,rmdir:Sl,unlink:bl}=Q,$s=async(i,t)=>{if(t?.signal?.aborted)throw t.signal.reason;try{return await Xn(i,t,await xl(i))}catch(e){if(e?.code==="ENOENT")return!0;throw e}},Ws=(i,t)=>{if(t?.signal?.aborted)throw t.signal.reason;try{return Zn(i,t,me(i))}catch(e){if(e?.code==="ENOENT")return!0;throw e}},Xn=async(i,t,e)=>{if(t?.signal?.aborted)throw t.signal.reason;let s=e.isDirectory()?await ye(i):null;if(!Array.isArray(s)){if(s){if(s.code==="ENOENT")return!0;if(s.code!=="ENOTDIR")throw s}return t.filter&&!await t.filter(i,e)?!1:(await At(bl(i)),!0)}return!(await Promise.all(s.map(n=>Xn(qn(i,n.name),t,n)))).reduce((n,o)=>n&&o,!0)||t.preserveRoot===!1&&i===Yn(i).root||t.filter&&!await t.filter(i,e)?!1:(await At(Sl(i)),!0)},Zn=(i,t,e)=>{if(t?.signal?.aborted)throw t.signal.reason;let s=e.isDirectory()?we(i):null;if(!Array.isArray(s)){if(s){if(s.code==="ENOENT")return!0;if(s.code!=="ENOTDIR")throw s}return t.filter&&!t.filter(i,e)?!1:(Rt(()=>ge(i)),!0)}let r=!0;for(let n of s){let o=qn(i,n.name);r=Zn(o,t,n)&&r}return t.preserveRoot===!1&&i===Yn(i).root||!r||t.filter&&!t.filter(i,e)?!1:(Rt(()=>pe(i)),!0)};import{parse as ao,resolve as co}from"path";var{chmod:El}=Q,_i=i=>async t=>{try{return await i(t)}catch(e){let s=e;if(s?.code==="ENOENT")return;if(s?.code==="EPERM"){try{await El(t,438)}catch(r){if(r?.code==="ENOENT")return;throw e}return await i(t)}throw e}},$i=i=>t=>{try{return i(t)}catch(e){let s=e;if(s?.code==="ENOENT")return;if(s?.code==="EPERM"){try{_s(t,438)}catch(r){if(r?.code==="ENOENT")return;throw e}return i(t)}throw e}};var Qn=new Set(["EMFILE","ENFILE","EBUSY"]),Wi=i=>{let t=async(e,s,r=1,n=0)=>{let o=s.maxBackoff||200,a=s.backoff||1.2,c=s.maxRetries||10,l=0;for(;;)try{return await i(e)}catch(h){let f=h;if(f?.path===e&&f?.code&&Qn.has(f.code)){if(r=Math.ceil(r*a),n=r+n,n<o)return new Promise((d,g)=>{setTimeout(()=>{t(e,s,r,n).then(d,g)},r)});if(l<c){l++;continue}}throw h}};return t},Bi=i=>(e,s)=>{let r=s.maxRetries||10,n=0;for(;;)try{return i(e)}catch(o){let a=o;if(a?.path===e&&a?.code&&Qn.has(a.code)&&n<r){n++;continue}throw o}};import{basename as kl,parse as zs,resolve as Gs}from"path";import{tmpdir as Us}from"os";import{parse as Bs,resolve as to}from"path";var{stat:vl}=Q,Tl=i=>{try{return Jn(i).isDirectory()}catch{return!1}},Cl=i=>vl(i).then(t=>t.isDirectory(),()=>!1),Al=async i=>{let{root:t}=Bs(i),e=Us(),{root:s}=Bs(e);if(t.toLowerCase()===s.toLowerCase())return e;let r=to(t,"/temp");return await Cl(r)?r:t},Rl=i=>{let{root:t}=Bs(i),e=Us(),{root:s}=Bs(e);if(t.toLowerCase()===s.toLowerCase())return e;let r=to(t,"/temp");return Tl(r)?r:t},Ol=async()=>Us(),Nl=()=>Us(),eo=at==="win32"?Al:Ol,so=at==="win32"?Rl:Nl;var{lstat:Dl,rename:Il,unlink:io,rmdir:Fl,chmod:jl}=Q,oo=i=>`.${kl(i)}.${Math.random()}`,Ll=async i=>io(i).catch(t=>{if(t.code==="EPERM")return jl(i,438).then(()=>io(i),e=>{if(e.code!=="ENOENT")throw t});if(t.code==="ENOENT")return;throw t}),Pl=i=>{try{ge(i)}catch(t){if(t?.code==="EPERM")try{return _s(i,438)}catch(e){if(e?.code==="ENOENT")return;throw t}else if(t?.code==="ENOENT")return;throw t}},Vs=async(i,t)=>{if(t?.signal?.aborted)throw t.signal.reason;try{return await Ui(i,t,await Dl(i))}catch(e){if(e?.code==="ENOENT")return!0;throw e}},Ui=async(i,t,e)=>{if(t?.signal?.aborted)throw t.signal.reason;if(!t.tmp)return Ui(i,{...t,tmp:await eo(i)},e);if(i===t.tmp&&zs(i).root!==i)throw new Error("cannot delete temp directory used for deletion");let s=e.isDirectory()?await ye(i):null;if(!Array.isArray(s)){if(s){if(s.code==="ENOENT")return!0;if(s.code!=="ENOTDIR")throw s}return t.filter&&!await t.filter(i,e)?!1:(await At(ro(i,t.tmp,Ll)),!0)}return!(await Promise.all(s.map(n=>Ui(Gs(i,n.name),t,n)))).reduce((n,o)=>n&&o,!0)||t.preserveRoot===!1&&i===zs(i).root||t.filter&&!await t.filter(i,e)?!1:(await At(ro(i,t.tmp,Fl)),!0)},ro=async(i,t,e)=>{let s=Gs(t,oo(i));return await Il(i,s),await e(s)},Ks=(i,t)=>{if(t?.signal?.aborted)throw t.signal.reason;try{return zi(i,t,me(i))}catch(e){if(e?.code==="ENOENT")return!0;throw e}},zi=(i,t,e)=>{if(t?.signal?.aborted)throw t.signal.reason;if(!t.tmp)return zi(i,{...t,tmp:so(i)},e);let s=t.tmp;if(i===t.tmp&&zs(i).root!==i)throw new Error("cannot delete temp directory used for deletion");let r=e.isDirectory()?we(i):null;if(!Array.isArray(r)){if(r){if(r.code==="ENOENT")return!0;if(r.code!=="ENOTDIR")throw r}return t.filter&&!t.filter(i,e)?!1:(Rt(()=>no(i,s,Pl)),!0)}let n=!0;for(let o of r){let a=Gs(i,o.name);n=zi(a,t,o)&&n}return!n||t.preserveRoot===!1&&i===zs(i).root||t.filter&&!t.filter(i,e)?!1:(Rt(()=>no(i,s,pe)),!0)},no=(i,t,e)=>{let s=Gs(t,oo(i));return Kn(i,s),e(s)};var{unlink:Ml,rmdir:_l,lstat:$l}=Q,Wl=Wi(_i(Ml)),Bl=Bi($i(ge)),Ul=Wi(_i(_l)),zl=Bi($i(pe)),Gl=async(i,t)=>{if(t?.signal?.aborted)throw t.signal.reason;let{filter:e,...s}=t;try{return await Ul(i,s)}catch(r){if(r?.code==="ENOTEMPTY")return await Vs(i,s);throw r}},Vl=(i,t)=>{if(t?.signal?.aborted)throw t.signal.reason;let{filter:e,...s}=t;try{return zl(i,s)}catch(r){if(r?.code==="ENOTEMPTY")return Ks(i,s);throw r}},_t=Symbol("start"),lo=Symbol("child"),Hs=Symbol("finish"),Js=async(i,t)=>{if(t?.signal?.aborted)throw t.signal.reason;try{return await Gi(i,t,await $l(i),_t)}catch(e){if(e?.code==="ENOENT")return!0;throw e}},Ys=(i,t)=>{if(t?.signal?.aborted)throw t.signal.reason;try{return Vi(i,t,me(i),_t)}catch(e){if(e?.code==="ENOENT")return!0;throw e}},Gi=async(i,t,e,s=_t)=>{if(t?.signal?.aborted)throw t.signal.reason;let r=e.isDirectory()?await ye(i):null;if(!Array.isArray(r)){if(r){if(r.code==="ENOENT")return!0;if(r.code!=="ENOTDIR")throw r}return t.filter&&!await t.filter(i,e)?!1:(await At(Wl(i,t)),!0)}let n=s===_t?lo:s,o=(await Promise.all(r.map(a=>Gi(co(i,a.name),t,a,n)))).reduce((a,c)=>a&&c,!0);if(s===_t)return Gi(i,t,e,Hs);if(s===Hs){if(t.preserveRoot===!1&&i===ao(i).root||!o||t.filter&&!await t.filter(i,e))return!1;await At(Gl(i,t))}return!0},Vi=(i,t,e,s=_t)=>{let r=e.isDirectory()?we(i):null;if(!Array.isArray(r)){if(r){if(r.code==="ENOENT")return!0;if(r.code!=="ENOTDIR")throw r}return t.filter&&!t.filter(i,e)?!1:(Rt(()=>Bl(i,t)),!0)}let n=!0;for(let o of r){let a=s===_t?lo:s,c=co(i,o.name);n=Vi(c,t,o,a)&&n}if(s===_t)return Vi(i,t,e,Hs);if(s===Hs){if(t.preserveRoot===!1&&i===ao(i).root||!n||t.filter&&!t.filter(i,e))return!1;Rt(()=>{Vl(i,t)})}return!0};var Ki=at==="win32"?Js:$s,Hi=at==="win32"?Ys:Ws;var{rm:Kl}=Q,Ji=async(i,t)=>(await Kl(i,{...t,force:!0,recursive:!0}),!0),Yi=(i,t)=>(Hn(i,{...t,force:!0,recursive:!0}),!0);var Hl=process.env.__TESTING_RIMRAF_NODE_VERSION__||process.version,qi=Hl.replace(/^v/,"").split("."),ho=+qi[0]>14||+qi[0]==14&&+qi[1]>=14,fo=!ho||at==="win32"?()=>!1:i=>!i?.signal&&!i?.filter,uo=!ho||at==="win32"?()=>!1:i=>!i?.signal&&!i?.filter;var $t=(i,t)=>typeof i>"u"||typeof i===t,Jl=i=>!!i&&typeof i=="object"&&$t(i.preserveRoot,"boolean")&&$t(i.tmp,"string")&&$t(i.maxRetries,"number")&&$t(i.retryDelay,"number")&&$t(i.backoff,"number")&&$t(i.maxBackoff,"number")&&($t(i.glob,"boolean")||i.glob&&typeof i.glob=="object")&&$t(i.filter,"function"),Lr=i=>{if(!Jl(i))throw new Error("invalid rimraf options")},Se=i=>async(t,e)=>{let s=Fr(e);return s.glob&&(t=await js(t,s.glob)),Array.isArray(t)?!!(await Promise.all(t.map(r=>i(Ie(r,s),s)))).reduce((r,n)=>r&&n,!0):!!await i(Ie(t,s),s)},be=i=>(t,e)=>{let s=jr(e);return s.glob&&(t=Ps(t,s.glob)),Array.isArray(t)?!!t.map(r=>i(Ie(r,s),s)).reduce((r,n)=>r&&n,!0):!!i(Ie(t,s),s)},go=be(Yi),Yl=Object.assign(Se(Ji),{sync:go}),yo=be(Hi),po=Object.assign(Se(Ki),{sync:yo}),wo=be(Ys),ql=Object.assign(Se(Js),{sync:wo}),xo=be(Ws),Xl=Object.assign(Se($s),{sync:xo}),So=be(Ks),Zl=Object.assign(Se(Vs),{sync:So}),mo=be((i,t)=>uo(t)?Yi(i,t):Hi(i,t));var xe=Object.assign(Se((i,t)=>fo(t)?Ji(i,t):Ki(i,t)),{rimraf:po,sync:mo,rimrafSync:mo,manual:po,manualSync:yo,native:Yl,nativeSync:go,posix:Xl,posixSync:xo,windows:ql,windowsSync:wo,moveRemove:Zl,moveRemoveSync:So});xe.rimraf=xe;import{existsSync as th,readFileSync as eh,writeFileSync as sh}from"fs";import{z as ih}from"zod";import rh from"prompts";import{pathToFileURL as nh}from"url";var qs=i=>nh(i).href,oh=new URL(import.meta.url),ah=N.dirname(oh.pathname),ts=new Ql("registry").description("Manage the project registry.");ts.command("init").description("Initialize the registry for a project.").argument("[project]","The project to initialize (default: default)","default").option("-r, --registry <registry>","the registry to use. We have blank, shadcn and aceternity. (default: blank)","shadcn").action(async(i,t)=>{try{await lh(i,t)}catch(e){v.error(`Error initializing registry: ${e.message}`)}});ts.command("build").description("Build the registry for a project.").argument("[project]","The project to build (default: default)","default").action(async i=>{try{await fh(i)}catch(t){v.error(`Error building registry: ${t.message}`)}});ts.command("add").description("Activate a registry by adding its URL to your project.").argument("<registryName>","Name of the registry to add").action(async i=>{let t=process.cwd(),e=N.join(t,"components.json");if(!th(e)){v.warn("components.json does not exist. Have you run the init command?");return}let s=await rh([{type:"text",name:"url",message:`Enter the URL for the ${i} registry:`,validate:o=>ch(o)||"Please enter a valid URL."}]),r=JSON.parse(eh(e,"utf8"));r.registries=r.registries||[];let n=r.registries.findIndex(o=>o.name===i);n>-1?(r.registries[n].baseUrl=s.url,v.info(`Updated ${i} registry URL to ${s.url}`)):(r.registries.push({name:i,baseUrl:s.url}),v.info(`Added ${i} registry with URL ${s.url}`)),sh(e,JSON.stringify(r,null,2),"utf8")});function ch(i){return ih.string().url().safeParse(i).success}async function lh(i,t){switch(i){case"default":await hh(t);break;default:v.warn("Unsupported project type.")}}async function hh(i){try{v.info("Initializing registry...");let{registry:t}=i,e=N.join(ah,"..","src","registries",t);e=decodeURIComponent(e),e=e.startsWith("\\")?e.substring(1):e;let s=N.join(process.cwd(),"src","registry");await Xs.ensureDir(s),await Xs.copy(e,s,{overwrite:!1,errorOnExist:!1}),console.log("\u2705 Registry initialized")}catch(t){gt(t)}}async function fh(i){switch(i){case"default":await uh();break;default:v.warn("Unsupported project type.")}}async function uh(){try{v.info("Building registry for Next.js project...");let i=N.join(process.cwd(),"public/registry"),{registry:t}=await import(qs(N.join(process.cwd(),"src/registry/registry.mjs"))),{styles:e}=await import(qs(N.join(process.cwd(),"src/registry/styles.mjs"))),{colorMapping:s,colors:r}=await import(qs(N.join(process.cwd(),"src/registry/colors.mjs"))),{themes:n}=await import(qs(N.join(process.cwd(),"src/registry/themes.mjs"))),o=or.safeParse(t);o.success||(console.error(o.error),process.exit(1));for(let p of e){let m=N.join(i,"styles",p.name);M.existsSync(m)||M.mkdirSync(m,{recursive:!0});for(let w of o.data){let x=w.files?.map(C=>{let L=N.join(process.cwd(),"src","registry",p.name,w.type.replace("components:",""),C),st=M.readFileSync(L,"utf8");return{name:N.basename(C),path:C,content:st}}),E={...w,files:x},T=N.join(i,"styles",p.name,`${w.name}.json`);M.mkdirSync(N.dirname(T),{recursive:!0}),M.writeFileSync(T,JSON.stringify(E,null,2),"utf8")}}let a=JSON.stringify(e,null,2);M.writeFileSync(N.join(i,"styles/index.json"),a,"utf8");let c=o.data.filter(p=>Ce.includes(p.type)),l=JSON.stringify(c,null,2);xe.sync(N.join(i,"index.json")),M.writeFileSync(N.join(i,"index.json"),l,"utf8");let h=N.join(i,"colors");xe.sync(h),M.existsSync(h)||M.mkdirSync(h,{recursive:!0});let f={};for(let[p,m]of Object.entries(r)){if(typeof m=="string"){f[p]=m;continue}if(Array.isArray(m)){f[p]=m.map(w=>({...w,rgbChannel:w.rgb.replace(/^rgb\((\d+),(\d+),(\d+)\)$/,"$1 $2 $3"),hslChannel:w.hsl.replace(/^hsl\(([\d.]+),([\d.]+%),([\d.]+%)\)$/,"$1 $2 $3")}));continue}if(typeof m=="object"){f[p]={...m,rgbChannel:m.rgb.replace(/^rgb\((\d+),(\d+),(\d+)\)$/,"$1 $2 $3"),hslChannel:m.hsl.replace(/^hsl\(([\d.]+),([\d.]+%),([\d.]+%)\)$/,"$1 $2 $3")};continue}}M.writeFileSync(N.join(h,"index.json"),JSON.stringify(f,null,2),"utf8");let d=`@tailwind base;
  @tailwind components;
  @tailwind utilities;
  `,g=`@tailwind base;
  @tailwind components;
  @tailwind utilities;
   
  @layer base {
    :root {
      --background: <%- colors.light["background"] %>;
      --foreground: <%- colors.light["foreground"] %>;
  
      --card: <%- colors.light["card"] %>;
      --card-foreground: <%- colors.light["card-foreground"] %>;
   
      --popover: <%- colors.light["popover"] %>;
      --popover-foreground: <%- colors.light["popover-foreground"] %>;
   
      --primary: <%- colors.light["primary"] %>;
      --primary-foreground: <%- colors.light["primary-foreground"] %>;
   
      --secondary: <%- colors.light["secondary"] %>;
      --secondary-foreground: <%- colors.light["secondary-foreground"] %>;
   
      --muted: <%- colors.light["muted"] %>;
      --muted-foreground: <%- colors.light["muted-foreground"] %>;
   
      --accent: <%- colors.light["accent"] %>;
      --accent-foreground: <%- colors.light["accent-foreground"] %>;
   
      --destructive: <%- colors.light["destructive"] %>;
      --destructive-foreground: <%- colors.light["destructive-foreground"] %>;
  
      --border: <%- colors.light["border"] %>;
      --input: <%- colors.light["input"] %>;
      --ring: <%- colors.light["ring"] %>;
   
      --radius: 0.5rem;
    }
   
    .dark {
      --background: <%- colors.dark["background"] %>;
      --foreground: <%- colors.dark["foreground"] %>;
   
      --card: <%- colors.dark["card"] %>;
      --card-foreground: <%- colors.dark["card-foreground"] %>;
   
      --popover: <%- colors.dark["popover"] %>;
      --popover-foreground: <%- colors.dark["popover-foreground"] %>;
   
      --primary: <%- colors.dark["primary"] %>;
      --primary-foreground: <%- colors.dark["primary-foreground"] %>;
   
      --secondary: <%- colors.dark["secondary"] %>;
      --secondary-foreground: <%- colors.dark["secondary-foreground"] %>;
   
      --muted: <%- colors.dark["muted"] %>;
      --muted-foreground: <%- colors.dark["muted-foreground"] %>;
   
      --accent: <%- colors.dark["accent"] %>;
      --accent-foreground: <%- colors.dark["accent-foreground"] %>;
   
      --destructive: <%- colors.dark["destructive"] %>;
      --destructive-foreground: <%- colors.dark["destructive-foreground"] %>;
   
      --border: <%- colors.dark["border"] %>;
      --input: <%- colors.dark["input"] %>;
      --ring: <%- colors.dark["ring"] %>;
    }
  }
   
  @layer base {
    * {
      @apply border-border;
    }
    body {
      @apply bg-background text-foreground;
    }
  }`;for(let p of["slate","gray","zinc","neutral","stone"]){let m={inlineColors:{},cssVars:{}};for(let[w,x]of Object.entries(s)){m.inlineColors[w]={},m.cssVars[w]={};for(let[E,T]of Object.entries(x))if(typeof T=="string"){let C=T.replace(/{{base}}-/g,`${p}-`);m.inlineColors[w][E]=C;let[L,st]=C.split("-"),K=st?f[L].find(mt=>mt.scale===parseInt(st)):f[L];K&&(m.cssVars[w][E]=K.hslChannel)}}m.inlineColorsTemplate=Xi(d)({}),m.cssVarsTemplate=Xi(g)({colors:m.cssVars}),M.writeFileSync(N.join(i,`colors/${p}.json`),JSON.stringify(m,null,2),"utf8")}let S=`
    .theme-<%- theme %> {
      --background: <%- colors.light["background"] %>;
      --foreground: <%- colors.light["foreground"] %>;
   
      --muted: <%- colors.light["muted"] %>;
      --muted-foreground: <%- colors.light["muted-foreground"] %>;
   
      --popover: <%- colors.light["popover"] %>;
      --popover-foreground: <%- colors.light["popover-foreground"] %>;
   
      --card: <%- colors.light["card"] %>;
      --card-foreground: <%- colors.light["card-foreground"] %>;
   
      --border: <%- colors.light["border"] %>;
      --input: <%- colors.light["input"] %>;
   
      --primary: <%- colors.light["primary"] %>;
      --primary-foreground: <%- colors.light["primary-foreground"] %>;
   
      --secondary: <%- colors.light["secondary"] %>;
      --secondary-foreground: <%- colors.light["secondary-foreground"] %>;
   
      --accent: <%- colors.light["accent"] %>;
      --accent-foreground: <%- colors.light["accent-foreground"] %>;
   
      --destructive: <%- colors.light["destructive"] %>;
      --destructive-foreground: <%- colors.light["destructive-foreground"] %>;
   
      --ring: <%- colors.light["ring"] %>;
   
      --radius: <%- colors.light["radius"] %>;
    }
   
    .dark .theme-<%- theme %> {
      --background: <%- colors.dark["background"] %>;
      --foreground: <%- colors.dark["foreground"] %>;
   
      --muted: <%- colors.dark["muted"] %>;
      --muted-foreground: <%- colors.dark["muted-foreground"] %>;
   
      --popover: <%- colors.dark["popover"] %>;
      --popover-foreground: <%- colors.dark["popover-foreground"] %>;
   
      --card: <%- colors.dark["card"] %>;
      --card-foreground: <%- colors.dark["card-foreground"] %>;
   
      --border: <%- colors.dark["border"] %>;
      --input: <%- colors.dark["input"] %>;
   
      --primary: <%- colors.dark["primary"] %>;
      --primary-foreground: <%- colors.dark["primary-foreground"] %>;
   
      --secondary: <%- colors.dark["secondary"] %>;
      --secondary-foreground: <%- colors.dark["secondary-foreground"] %>;
   
      --accent: <%- colors.dark["accent"] %>;
      --accent-foreground: <%- colors.dark["accent-foreground"] %>;
   
      --destructive: <%- colors.dark["destructive"] %>;
      --destructive-foreground: <%- colors.dark["destructive-foreground"] %>;
   
      --ring: <%- colors.dark["ring"] %>;
    }`,u=[];for(let p of n)u.push(Xi(S)({colors:p.cssVars,theme:p.name}));M.writeFileSync(N.join(i,"themes.css"),u.join(`
`),"utf8"),xe.sync(N.join(i,"themes"));for(let p of["slate","gray","zinc","neutral","stone"]){let m={name:p,label:p.charAt(0).toUpperCase()+p.slice(1),cssVars:{}};for(let[x,E]of Object.entries(s)){m.cssVars[x]={};for(let[T,C]of Object.entries(E))if(typeof C=="string"){let L=C.replace(/{{base}}-/g,`${p}-`);m.cssVars[x][T]=L;let[st,K]=L.split("-"),mt=K?f[st].find(Eo=>Eo.scale===parseInt(K)):f[st];mt&&(m.cssVars[x][T]=mt.hslChannel)}}let w=N.join(i,"themes");M.existsSync(w)||M.mkdirSync(w,{recursive:!0}),M.writeFileSync(N.join(w,`${m.name}.json`),JSON.stringify(m,null,2),"utf8")}console.log("\u2705 Done!")}catch(i){gt(i)}}import{Command as mh}from"commander";import dh from"path";import ph from"fs-extra";function bo(){let i=dh.join("package.json");return ph.readJSONSync(i)}process.on("SIGINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function gh(){let i=await bo(),t=new mh().name("shadxn").description("add components and dependencies to your project").version(i.version||"1.0.0","-v, --version","display the version number");t.addCommand(Dr).addCommand(wr).addCommand(Sr).addCommand(ts),t.parse()}gh();
//# sourceMappingURL=index.js.map